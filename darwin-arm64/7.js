var R=Object.defineProperty;var D=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(e,r,o)=>r in e?R(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,B=(e,r)=>{for(var o in r||(r={}))q.call(r,o)&&A(e,o,r[o]);if(D)for(var o of D(r))G.call(r,o)&&A(e,o,r[o]);return e};import{c as s,m as K}from"./q.js";import{i as v}from"./0.js";import{G as E,o as W,d as l,a as u,F as S,P as C,m as T,e as n,t as k,p as x,i as V,_ as I,v as J,K as j,R as F,s as U,k as Q,b as h,f as w,c as X,w as H,j as Y,h as Z}from"./d.js";import{z as ee}from"./$$.js";import{b as re}from"./i.js";import{s as ae}from"./z.js";import{v as oe}from"./..js";import{H as N}from"./k.js";import"./.js";import"./-.js";import"./$.js";import"./l.js";var $,P,y;({camera:$,main:P}=v);y=()=>{var e,r;if(gc(),document.hidden){localStorage.recing||$.x();return}switch(delete localStorage.recing,{src:e}=s,$.x(),e){case"screen":s.video="";break;default:if(!s.video){if({video:r}=localStorage,!r)return;s.video=r}e==="all"?$.circle(localStorage.人像尺寸-0):$.rect(),setTimeout(()=>{document.hidden||P(!1)},1e3)}};document.addEventListener("visibilitychange",y);var te={setup:()=>{var e,r,o,a,t,i;for(a=["all 屏幕+摄像头录制","screen 屏幕录制","camera 摄像头录制"],i=r=0,o=a.length;r<o;i=++r)e=a[i],t=e.indexOf(" "),a[i]=[e.slice(0,t),e.slice(1+t)];return E(()=>s.src,y),W(y),E(()=>s.video,d=>{var c;document.hidden||({src:c}=s,d?c==="screen"&&(s.src=localStorage.src||"all"):c!=="screen"&&(localStorage.src=s.src,s.src="screen"),y())}),{li:a,config:s,go:d=>{s.src=d}}}};const se=e=>(x("data-v-1eb91dd6"),e=e(),V(),e),ie={class:"method"},ne=["onClick"],de=se(()=>n("b",{class:"ico"},null,-1));function ce(e,r){return l(),u("div",ie,[(l(!0),u(S,null,C(e.li,([o,a])=>(l(),u("a",{class:T([o,e.config.src==o?"now":""]),onClick:t=>e.go(o)},[de,n("i",null,k(a),1)],10,ne))),256))])}var le=I(te,[["render",ce],["__scopeId","data-v-1eb91dd6"]]),ue={setup:()=>({config:s,disabled:J(()=>s.src==="camera"),li:"整个桌面 应用窗口 指定区域".split(" ")})};const _e=e=>(x("data-v-cf47a3ec"),e=e(),V(),e),ve={class:"bk"},fe=_e(()=>n("h2",null,"录制区域",-1)),pe={class:"select"},me=["disabled"],he=["value"];function ge(e,r){return l(),u("div",ve,[fe,n("div",pe,[j(n("select",{disabled:e.disabled,"onUpdate:modelValue":r[0]||(r[0]=o=>e.config.area=o)},[(l(!0),u(S,null,C(e.li,(o,a)=>(l(),u("option",{value:a},k(o),9,he))),256))],8,me),[[F,e.config.area]])])])}var be=I(ue,[["render",ge],["__scopeId","data-v-cf47a3ec"]]),we={components:{zAudio:ee},setup:()=>{var e,r,o;return o={audio:U([]),video:U([])},{mediaDevices:e}=navigator,r=async()=>{var a,t,i,d,c,f,g,_,p,b,m;f={},g=await e.enumerateDevices();for(b of g)({kind:d,label:c,deviceId:a}=b),a==="default"&&(c=c.replace("Default - ","默认 ")),d.endsWith("input")&&(d=d.slice(0,-5),(f[d]=f[d]||[]).push([a,c]));for(i in o)o[i].value=f[i]||[];for(i in o){if({value:p}=o[i],p.length){if(_=s[i],_){for(m of p)if([t]=m,_===t)return}_!==""&&(_=p[0][0])}else _=0;s[i]=_}},Q(()=>{var a,t,i,d,c;t=[["audio","microphone"],["video","camera"]];for(d of t)[a,c]=d,i=s[a],i&&(v.permission(c),localStorage[a]=i)}),(async()=>await r())(),B({refresh:r,config:s,x:a=>{var t;t=s[a],t?t="":t=localStorage[a]||"",s[a]=t}},o)}};const z=e=>(x("data-v-620b4a5a"),e=e(),V(),e),$e={class:"bk"},ye=z(()=>n("h2",null,"设备设置",-1)),Se={class:"video"},ke={class:"select"},Ie={label:"输入源"},Ce=["value"],xe=z(()=>n("optgroup",{label:"───"},[n("option",{value:""},"禁用")],-1)),Ve={class:"audio"},je={class:"select"},Fe={label:"输入源"},Ue=["value"],ze=z(()=>n("optgroup",{label:"───"},[n("option",{value:""},"禁用")],-1));function De(e,r){const o=h("z-audio");return l(),u("div",$e,[ye,n("li",Se,[n("label",{class:T({x:!e.config.video}),onClick:r[0]||(r[0]=a=>e.x("video")),for:"driveVideo"},null,2),n("div",ke,[j(n("select",{id:"driveVideo",onFocus:r[1]||(r[1]=(...a)=>e.refresh&&e.refresh(...a)),"onUpdate:modelValue":r[2]||(r[2]=a=>e.config.video=a)},[n("optgroup",Ie,[(l(!0),u(S,null,C(e.video,([a,t])=>(l(),u("option",{value:a},k(t),9,Ce))),256))]),xe],544),[[F,e.config.video]])])]),n("li",Ve,[n("label",{onClick:r[3]||(r[3]=a=>e.x("audio")),for:"driveAudio"},[w(o)]),n("div",je,[j(n("select",{id:"driveAudio",onFocus:r[4]||(r[4]=(...a)=>e.refresh&&e.refresh(...a)),"onUpdate:modelValue":r[5]||(r[5]=a=>e.config.audio=a)},[n("optgroup",Fe,[(l(!0),u(S,null,C(e.audio,([a,t])=>(l(),u("option",{value:a},k(t),9,Ue))),256))]),ze],544),[[F,e.config.audio]])])])])}var Ae=I(we,[["render",De],["__scopeId","data-v-620b4a5a"]]),Be={components:{btn:re}};const Ee=e=>(x("data-v-b0e482fa"),e=e(),V(),e),Te=Ee(()=>n("b",null,null,-1));function He(e,r){const o=h("btn");return l(),X(o,null,{default:H(()=>[Te,Y(e.$slots,"default",{},void 0,!0)]),_:3})}var Ne=I(Be,[["render",He],["__scopeId","data-v-b0e482fa"]]);var L,M;M=()=>{var e;return e=new Headers,e.append("user_token",localStorage.uid),e};L=class{constructor(r){this.json=this.json.bind(this),this.ipc=r}async fetch(r,o={}){var a;if(o.headers=M(),r.indexOf(".do")<0&&(r+=".do"),a=await fetch(N+r,o),a.status===401){delete localStorage.uid,this.ipc.auto_update.relaunch();return}return a}async json(r,o={}){var a;return a=await this.fetch(r,o),a.json()}};var Pe=e=>new L(e);var Le=Pe(v),Me=new Proxy(()=>{},{get:(e,r)=>{_paq.push(["trackEvent","点",r])}}),O;({auto_update:O}=v);var Oe={components:{src:le,rArea:be,drive:Ae,btn:Ne},setup:()=>{var e,r,o;return r="开始录制",e=U(r),o=a=>{e.value=`请授权${a}后点此录制`},{txt:e,start:async()=>{var a,t,i,d,c,f,g,_,p,b;{g=[["audio","麦克风","microphone"],["video","摄像头","camera"]];for(p of g)if([i,t,b]=p,c=s[i],c)try{await K[i](c)}catch(m){if(d=m,await v.permission(b)){o(t);return}alert(d);return}if(s.src!=="camera")try{await oe()}catch(m){if(d=m,await v.permission("screen")){o("录屏");return}alert(d);return}if(s.area-1===0&&await v.permission("accessibility")){o("辅助功能");return}}localStorage.recing=1,{avatarUrl:a,space:{used:_,max:f}}=await Le.json("user/get"),localStorage.ico=a,_>=f?(e.value="请付费扩容后点此录制",v.open(N+"?pay=true&user_token="+localStorage.uid)):(e.value=r,Me.录,ae())}}}};(async()=>await O.update_promise())();function Re(e,r){const o=h("src"),a=h("r-area"),t=h("drive"),i=h("btn");return l(),u(S,null,[w(o),n("main",null,[w(a),w(t),w(i,{onClick:e.start},{default:H(()=>[Z(k(e.txt),1)]),_:1},8,["onClick"])])],64)}var sr=I(Oe,[["render",Re],["__scopeId","data-v-4e6195cc"]]);export{sr as default};
