var le=Object.defineProperty;var G=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var J=(e,t,o)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,K=(e,t)=>{for(var o in t||(t={}))de.call(t,o)&&J(e,o,t[o]);if(G)for(var o of G(t))ce.call(t,o)&&J(e,o,t[o]);return e};import{c as a}from"./o.js";import{i as v}from"./2.js";import{G as Q,o as O,d as c,a as u,M as E,Q as U,m as Y,e as n,t as C,p as M,i as R,_ as b,y as ue,K as z,S as D,s as T,k as P,b as m,f as y,U as X,v as _e,c as fe,w as Z,j as ve,h as pe}from"./c.js";import{z as me}from"./f.js";import{p as ge,m as he}from"./r.js";import{b as ye}from"./0.js";import{a as ee,u as be}from"./4.js";import{H as te}from"./l.js";import{s as we}from"./w.js";import{v as $e}from"./x.js";import"./9.js";import"./..js";import"./$.js";import"./q.js";var g=function(e,t){_paq.push(["trackEvent",e,t,"",""])},ke=function(e,t,o){_paq.push(["trackEvent",e,t,"","",o])},B,A,k,oe,ae,S;({camera:k,main:oe}=v);B="PreOfRec";S=()=>{var e,t;if(gc(),document.hidden){localStorage.recing||k.x();return}switch(delete localStorage.recing,{src:e}=a,k.x(),e){case"screen":a.video="";break;default:if(!a.video){if({video:t}=localStorage,!t){a.src="screen";return}a.video=t}e==="all"?k.circle(localStorage.face_area_size-0):k.rect(),setTimeout(()=>{document.hidden||oe(!1)},1e3)}};ae=()=>{var e;switch({src:e}=a,e){case"all":g(B,"RecMode.Scr&Cam.Click");break;case"screen":g(B,"RecMode.Scr.Click");break;default:g(B,"RecMode.Cam.Click")}};document.addEventListener("visibilitychange",()=>{if(S(),!navigator.onLine)return A()});A=()=>{gc(),localStorage.recing||k.x()};window.addEventListener("online",()=>{S()});window.addEventListener("offline",()=>{A()});var Se={setup:()=>{var e,t,o,r,i,l;for(r=["all 屏幕+摄像头录制","screen 屏幕录制","camera 摄像头录制"],l=t=0,o=r.length;t<o;l=++t)e=r[l],i=e.indexOf(" "),r[l]=[e.slice(0,i),e.slice(1+i)];return Q(()=>a.src,S),O(S),Q(()=>a.video,s=>{var d;document.hidden||({src:d}=a,s?d==="screen"&&(a.src=localStorage.src||"all"):d!=="screen"&&(localStorage.src=a.src,a.src="screen"),S())}),{li:r,config:a,go:s=>{a.src=s,ae()}}}};const Ce=e=>(M("data-v-e013a56e"),e=e(),R(),e),xe={class:"method"},Ie=["onClick"],Le=Ce(()=>n("b",{class:"ico"},null,-1));function Ve(e,t){return c(),u("div",xe,[(c(!0),u(E,null,U(e.li,([o,r])=>(c(),u("a",{class:Y([o,e.config.src==o?"now":"",e.config.no_video_src==!0?"forbidden":""]),onClick:i=>e.go(o)},[Le,n("i",null,C(r),1)],10,Ie))),256))])}var Ee=b(Se,[["render",Ve],["__scopeId","data-v-e013a56e"]]),ze={setup:()=>({config:a,disabled:ue(()=>a.src==="camera"),li:"整个桌面 应用窗口 指定区域".split(" ")})};const Me=e=>(M("data-v-cf47a3ec"),e=e(),R(),e),Re={class:"bk"},Be=Me(()=>n("h2",null,"录制区域",-1)),Ue={class:"select"},Te=["disabled"],De=["value"];function Ne(e,t){return c(),u("div",Re,[Be,n("div",Ue,[z(n("select",{disabled:e.disabled,"onUpdate:modelValue":t[0]||(t[0]=o=>e.config.area=o)},[(c(!0),u(E,null,U(e.li,(o,r)=>(c(),u("option",{value:r},C(o),9,De))),256))],8,Te),[[D,e.config.area]])])])}var Oe=b(ze,[["render",Ne],["__scopeId","data-v-cf47a3ec"]]),V;V="PreOfRec";var Pe={components:{zAudio:me},setup:()=>{var e,t,o,r;return r={audio:T([]),video:T([])},{mediaDevices:e}=navigator,o=i=>{i==="audio"?a[i]?g(V,"MikeSwitch.Click"):g(V,"MikeClose.Click"):a[i]?g(V,"CamSwitch.Click"):g(V,"CamClose.Click")},t=async()=>{var i,l,s,d,x,f,h,I,w,$,j,_,p,L,F,H,q;h={},p={audio:{exist:!1,default_id:""},video:{exist:!1,default_id:""}},w=await e.enumerateDevices();for(F of w)({kind:d,label:f,deviceId:i}=F),i==="default"&&(f=f.replace("Default - ",""),f="默认 "+f),d.endsWith("input")&&(d=d.slice(0,-5),(h[d]=h[d]||[]).push([i,f]),localStorage[d]===i&&(p[d].exist=!0),(p[d].default_id===""||i==="default")&&(p[d].default_id=i));for(s in r)r[s].value=h[s]||[];for(s in r){if({value:L}=r[s],L.length){if(_=a[s],_){for(H of L)if([l]=H,_===l)return}if(_!==""){for(q of L){if([l,x]=q,_)break;if(l==="default"){_=l;break}I=x.toLowerCase(),$=["default","built-in","内建","默认"];for(j of $)if(I.includes(j)){_=l;break}}_||(_=L[0][0])}}else _="";a[s]=_}for(s in p)p[s].exist||(localStorage.removeItem(s),a[s]?localStorage[s]=a[s]:p[s].default_id!==""&&(localStorage[s]=p[s].default_id));a.no_video_src=!localStorage.video},P(()=>{var i,l,s;l=["audio","video"];for(i of l)s=a[i],s&&(localStorage[i]=s)}),(async()=>await t())(),K({refresh:t,report:o,config:a,x:i=>{var l;l=a[i],l?l="":l=localStorage[i]||"",a[i]=l,o(i)}},r)}};const W=e=>(M("data-v-588cc943"),e=e(),R(),e),Ae={class:"bk"},We=W(()=>n("h2",null,"设备设置",-1)),je={class:"video"},Fe={class:"select"},He={label:"输入源"},qe=["value"],Ge=W(()=>n("optgroup",{label:"───"},[n("option",{value:""},"禁用")],-1)),Je={class:"audio"},Ke={class:"select"},Qe={label:"输入源"},Xe=["value"],Ye=W(()=>n("optgroup",{label:"───"},[n("option",{value:""},"禁用")],-1));function Ze(e,t){const o=m("z-audio");return c(),u("div",Ae,[We,n("li",je,[n("label",{class:Y({x:!e.config.video}),onClick:t[0]||(t[0]=r=>e.x("video")),for:"driveVideo"},null,2),n("div",Fe,[z(n("select",{id:"driveVideo",onFocus:t[1]||(t[1]=(...r)=>e.refresh&&e.refresh(...r)),"onUpdate:modelValue":t[2]||(t[2]=r=>e.config.video=r),onChange:t[3]||(t[3]=r=>e.report("video"))},[n("optgroup",He,[(c(!0),u(E,null,U(e.video,([r,i])=>(c(),u("option",{value:r},C(i),9,qe))),256))]),Ge],544),[[D,e.config.video]])])]),n("li",Je,[n("label",{onClick:t[4]||(t[4]=r=>e.x("audio")),for:"driveAudio"},[y(o)]),n("div",Ke,[z(n("select",{id:"driveAudio",onFocus:t[5]||(t[5]=(...r)=>e.refresh&&e.refresh(...r)),"onUpdate:modelValue":t[6]||(t[6]=r=>e.config.audio=r),onChange:t[7]||(t[7]=r=>e.report("audio"))},[n("optgroup",Qe,[(c(!0),u(E,null,U(e.audio,([r,i])=>(c(),u("option",{value:r},C(i),9,Xe))),256))]),Ye],544),[[D,e.config.audio]])])])])}var et=b(Pe,[["render",Ze],["__scopeId","data-v-588cc943"]]),re,ie;({auto_start:re}=v);ie=ge==="win32";var tt={setup:()=>{var e,t;return a.sys_audio===void 0&&(a.sys_audio=!0),a.auto_start===void 0&&(a.auto_start=!0),t=window.innerWidth,e=window.innerHeight,P(()=>{var o,r,i;r=["sys_audio","auto_start"];for(o of r)i=a[o],localStorage[o]=i;re.auto_start(a.auto_start)}),{config:a,isWin:ie,toggle:()=>(document.getElementById("extra").classList.toggle("active"),document.getElementById("extra-setting").classList.toggle("active"),document.getElementById("extra").classList.contains("active")?window.resizeTo(t,e+35):window.resizeTo(t,e))}}};const se=e=>(M("data-v-4ebae813"),e=e(),R(),e),ot={class:"bk"},at={id:"extra-setting"},rt={key:0,class:"box"},it=se(()=>n("label",{for:"sys-audio"},"录制系统声音",-1)),st={class:"box"},nt=se(()=>n("label",{for:"auto-start"},"开机自动启动",-1));function lt(e,t){return c(),u("div",ot,[n("h2",{id:"extra",onClick:t[0]||(t[0]=(...o)=>e.toggle&&e.toggle(...o))},"其他设置"),n("li",at,[e.isWin?(c(),u("div",rt,[z(n("input",{id:"sys-audio",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=o=>e.config.sys_audio=o)},null,512),[[X,e.config.sys_audio]]),it])):_e("",!0),n("div",st,[z(n("input",{id:"auto-start",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>e.config.auto_start=o)},null,512),[[X,e.config.auto_start]]),nt])])])}var dt=b(tt,[["render",lt],["__scopeId","data-v-4ebae813"]]),ct={components:{btn:ye}};const ut=e=>(M("data-v-b0e482fa"),e=e(),R(),e),_t=ut(()=>n("b",null,null,-1));function ft(e,t){const o=m("btn");return c(),fe(o,null,{default:Z(()=>[_t,ve(e.$slots,"default",{},void 0,!0)]),_:3})}var vt=b(ct,[["render",ft],["__scopeId","data-v-b0e482fa"]]),pt={setup:()=>{var e;return e=T('单次最长录制30分钟, "扩容"可获更长时间'),O(async()=>{await ee()}),P(()=>{a.duration_txt&&(e.value=a.duration_txt)}),{txt:e,pay:()=>v.open(te+"?pay=true&user_token="+localStorage.uid)}}};function mt(e,t){return c(),u("a",{onClick:t[0]||(t[0]=(...o)=>e.pay&&e.pay(...o))},C(e.txt),1)}var gt=b(pt,[["render",mt],["__scopeId","data-v-234a3262"]]),N,ne;({auto_update:ne}=v);N="PreOfRec";var ht={components:{src:Ee,rArea:Oe,drive:et,extra:dt,btn:vt,durationLimit:gt},setup:()=>{var e,t,o;return t="开始录制",e=T(t),o=r=>{e.value=`请授权${r}后点此录制`},O(()=>{g(N,"RecPop.View")}),{txt:e,start:async()=>{var r,i,l,s,d,x,f,h,I,w;{f=[["audio","麦克风","microphone"],["video","摄像头","camera"]];for(I of f)if([l,i,w]=I,d=a[l],d){try{await he[l](d)}catch($){if(s=$,await v.permission(w)){o(i);return}alert(s);return}if(await v.permission(w)){o(i);return}}if(a.src!=="camera")try{await $e()}catch($){if(s=$,await v.permission("screen")){o("屏幕录制");return}alert(s);return}if(a.area-1===0&&await v.permission("accessibility")){o("辅助功能");return}}localStorage.recing=1,{avatarUrl:r,space:{used:h,max:x}}=await be.json("user/get"),await ee(),localStorage.ico=r,h>=x?(e.value="请付费扩容后点此录制",v.open(te+"?pay=true&user_token="+localStorage.uid)):(e.value=t,ke(N,"RecStart.Click",JSON.stringify({src:a.src,area:a.area,audio:!!a.audio,video:!!a.video})),we())}}}};(async()=>await ne.update_promise())();function yt(e,t){const o=m("src"),r=m("r-area"),i=m("drive"),l=m("extra"),s=m("btn"),d=m("durationLimit");return c(),u(E,null,[y(o),n("main",null,[y(r),y(i),y(l),y(s,{onClick:e.start},{default:Z(()=>[pe(C(e.txt),1)]),_:1},8,["onClick"]),y(d)])],64)}var Ut=b(ht,[["render",yt],["__scopeId","data-v-cc5225a6"]]);export{Ut as default};
