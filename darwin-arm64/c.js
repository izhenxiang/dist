var R=Object.defineProperty;var D=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(e,r,t)=>r in e?R(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,B=(e,r)=>{for(var t in r||(r={}))q.call(r,t)&&A(e,t,r[t]);if(D)for(var t of D(r))G.call(r,t)&&A(e,t,r[t]);return e};import{c as s,m as K}from"./$..js";import{i as w}from"./3.js";import{G as E,o as W,d as l,a as u,F as y,P as I,m as T,e as n,t as S,p as C,i as j,_ as k,v as J,K as V,R as x,s as F,k as Q,b as m,f as g,c as X,w as H,j as Y,h as Z}from"./f.js";import{z as ee}from"./$-.js";import{b as re}from"./y.js";import{s as oe}from"./8.js";import{v as te}from"./1.js";import{H as N}from"./j.js";import"./s.js";import"./..js";import"./-.js";import"./n.js";var b,O,$;({camera:b,main:O}=w);$=()=>{var e,r;if(gc(),document.hidden){localStorage.recing||b.x();return}switch(delete localStorage.recing,{src:e}=s,b.x(),e){case"screen":s.video="";break;default:if(!s.video){if({video:r}=localStorage,!r)return;s.video=r}e==="all"?b.circle(localStorage.人像尺寸-0):b.rect(),setTimeout(()=>{document.hidden||O(!1)},1e3)}};document.addEventListener("visibilitychange",$);var ae={setup:()=>{var e,r,t,o,a,i;for(o=["all 屏幕+摄像头录制","screen 屏幕录制","camera 摄像头录制"],i=r=0,t=o.length;r<t;i=++r)e=o[i],a=e.indexOf(" "),o[i]=[e.slice(0,a),e.slice(1+a)];return E(()=>s.src,$),W($),E(()=>s.video,d=>{var c;document.hidden||({src:c}=s,d?c==="screen"&&(s.src=localStorage.src||"all"):c!=="screen"&&(localStorage.src=s.src,s.src="screen"),$())}),{li:o,config:s,go:d=>{s.src=d}}}};const se=e=>(C("data-v-1eb91dd6"),e=e(),j(),e),ie={class:"method"},ne=["onClick"],de=se(()=>n("b",{class:"ico"},null,-1));function le(e,r){return l(),u("div",ie,[(l(!0),u(y,null,I(e.li,([t,o])=>(l(),u("a",{class:T([t,e.config.src==t?"now":""]),onClick:a=>e.go(t)},[de,n("i",null,S(o),1)],10,ne))),256))])}var ce=k(ae,[["render",le],["__scopeId","data-v-1eb91dd6"]]),ue={setup:()=>({config:s,disabled:J(()=>s.src==="camera"),li:"整个桌面 应用窗口 指定区域".split(" ")})};const _e=e=>(C("data-v-cf47a3ec"),e=e(),j(),e),ve={class:"bk"},fe=_e(()=>n("h2",null,"录制区域",-1)),pe={class:"select"},me=["disabled"],he=["value"];function ge(e,r){return l(),u("div",ve,[fe,n("div",pe,[V(n("select",{disabled:e.disabled,"onUpdate:modelValue":r[0]||(r[0]=t=>e.config.area=t)},[(l(!0),u(y,null,I(e.li,(t,o)=>(l(),u("option",{value:o},S(t),9,he))),256))],8,me),[[x,e.config.area]])])])}var be=k(ue,[["render",ge],["__scopeId","data-v-cf47a3ec"]]),$e={components:{zAudio:ee},setup:()=>{var e,r,t;return t={audio:F([]),video:F([])},{mediaDevices:e}=navigator,r=async()=>{var o,a,i,d,c,v,h,_,f,p,z;v={},h=await e.enumerateDevices();for(p of h)({kind:d,label:c,deviceId:o}=p),o==="default"&&(c=c.replace("Default - ","默认 ")),d.endsWith("input")&&(d=d.slice(0,-5),(v[d]=v[d]||[]).push([o,c]));for(i in t)t[i].value=v[i]||[];for(i in t){if({value:f}=t[i],f.length){if(_=s[i],_){for(z of f)if([a]=z,_===a)return}_!==""&&(_=f[0][0])}else _=0;s[i]=_}},Q(()=>{var o,a,i;a=["audio","video"];for(o of a)i=s[o],i&&(localStorage[o]=i)}),(async()=>await r())(),B({refresh:r,config:s,x:o=>{var a;a=s[o],a?a="":a=localStorage[o]||"",s[o]=a}},t)}};const U=e=>(C("data-v-e19e988e"),e=e(),j(),e),we={class:"bk"},ye=U(()=>n("h2",null,"设备设置",-1)),Se={class:"video"},ke={class:"select"},Ie={label:"输入源"},Ce=["value"],je=U(()=>n("optgroup",{label:"───"},[n("option",{value:""},"禁用")],-1)),Ve={class:"audio"},xe={class:"select"},Fe={label:"输入源"},Ue=["value"],ze=U(()=>n("optgroup",{label:"───"},[n("option",{value:""},"禁用")],-1));function De(e,r){const t=m("z-audio");return l(),u("div",we,[ye,n("li",Se,[n("label",{class:T({x:!e.config.video}),onClick:r[0]||(r[0]=o=>e.x("video")),for:"driveVideo"},null,2),n("div",ke,[V(n("select",{id:"driveVideo",onFocus:r[1]||(r[1]=(...o)=>e.refresh&&e.refresh(...o)),"onUpdate:modelValue":r[2]||(r[2]=o=>e.config.video=o)},[n("optgroup",Ie,[(l(!0),u(y,null,I(e.video,([o,a])=>(l(),u("option",{value:o},S(a),9,Ce))),256))]),je],544),[[x,e.config.video]])])]),n("li",Ve,[n("label",{onClick:r[3]||(r[3]=o=>e.x("audio")),for:"driveAudio"},[g(t)]),n("div",xe,[V(n("select",{id:"driveAudio",onFocus:r[4]||(r[4]=(...o)=>e.refresh&&e.refresh(...o)),"onUpdate:modelValue":r[5]||(r[5]=o=>e.config.audio=o)},[n("optgroup",Fe,[(l(!0),u(y,null,I(e.audio,([o,a])=>(l(),u("option",{value:o},S(a),9,Ue))),256))]),ze],544),[[x,e.config.audio]])])])])}var Ae=k($e,[["render",De],["__scopeId","data-v-e19e988e"]]),Be={components:{btn:re}};const Ee=e=>(C("data-v-b0e482fa"),e=e(),j(),e),Te=Ee(()=>n("b",null,null,-1));function He(e,r){const t=m("btn");return l(),X(t,null,{default:H(()=>[Te,Y(e.$slots,"default",{},void 0,!0)]),_:3})}var Ne=k(Be,[["render",He],["__scopeId","data-v-b0e482fa"]]);var P,L;L=()=>{var e;return e=new Headers,e.append("user_token",localStorage.uid),e};P=class{constructor(r){this.json=this.json.bind(this),this.ipc=r}async fetch(r,t={}){var o;if(t.headers=L(),r.indexOf(".do")<0&&(r+=".do"),o=await fetch(N+r,t),o.status===401){delete localStorage.uid,this.ipc.auto_update.relaunch();return}return o}async json(r,t={}){var o;return o=await this.fetch(r,t),o.json()}};var Oe=e=>new P(e);var Pe=Oe(w),Le=new Proxy(()=>{},{get:(e,r)=>{_paq.push(["trackEvent","点",r])}}),M;({auto_update:M}=w);var Me={components:{src:ce,rArea:be,drive:Ae,btn:Ne},setup:()=>{var e,r,t;return r="开始录制",e=F(r),t=o=>{e.value=`请授权${o}后点此录制`},{txt:e,start:async()=>{var o,a,i,d,c,v,h,_,f;h=Object.entries({audio:"麦克风",video:"摄像头"});for(f of h)if([i,a]=f,c=s[i],c)try{await K[i](c)}catch(p){d=p,t(a);return}if(s.src!=="camera")try{await te()}catch(p){d=p,t("录屏");return}if(s.area-1===0&&(d=await w.permission(),d)){t(d);return}localStorage.recing=1,{avatarUrl:o,space:{used:_,max:v}}=await Pe.json("user/get"),localStorage.ico=o,_>=v?(e.value="请付费扩容后点此录制",w.open(N+"?pay=true&user_token="+localStorage.uid)):(e.value=r,Le.录,oe())}}}};(async()=>await M.update_promise())();function Re(e,r){const t=m("src"),o=m("r-area"),a=m("drive"),i=m("btn");return l(),u(y,null,[g(t),n("main",null,[g(o),g(a),g(i,{onClick:e.start},{default:H(()=>[Z(S(e.txt),1)]),_:1},8,["onClick"])])],64)}var sr=k(Me,[["render",Re],["__scopeId","data-v-d174a91e"]]);export{sr as default};
