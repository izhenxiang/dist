var se=Object.defineProperty;var q=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var J=(e,t,o)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,G=(e,t)=>{for(var o in t||(t={}))ne.call(t,o)&&J(e,o,t[o]);if(q)for(var o of q(t))le.call(t,o)&&J(e,o,t[o]);return e};import{c as r}from"./$.js";import{i as I}from"./3.js";import{I as K,o as U,d as c,a as u,F as w,R as L,m as X,e as s,t as y,p as x,i as V,_ as g,z as de,M as C,S as E,s as M,k as T,b as v,f as m,U as Q,x as ce,c as ue,w as Y,j as _e,h as fe}from"./f.js";import{z as ve}from"./$1.js";import{p as pe}from"./_.js";import{b as me}from"./.js";import{a as ge,u as he}from"./6.js";import{H as Z}from"./o.js";import{s as ye}from"./a.js";import"./z.js";import"./-.js";import"./1.js";import"./0.js";import"./s.js";var p=function(e,t){_paq.push(["trackEvent",e,t,"",""])},be=function(e,t,o){_paq.push(["trackEvent",e,t,"","",o])},z,$,ee,te,k;({camera:$,main:ee}=I);z="PreOfRec";k=()=>{var e,t;if(gc(),document.hidden){localStorage.recing||$.x();return}switch(delete localStorage.recing,{src:e}=r,$.x(),e){case"screen":r.video="";break;default:if(!r.video){if({video:t}=localStorage,!t){r.src="screen";return}r.video=t}e==="all"?$.circle(localStorage.人像尺寸-0):$.rect(),setTimeout(()=>{document.hidden||ee(!1)},1e3)}};te=()=>{var e;switch({src:e}=r,e){case"all":p(z,"RecMode.Scr&Cam.Click");break;case"screen":p(z,"RecMode.Scr.Click");break;default:p(z,"RecMode.Cam.Click")}};document.addEventListener("visibilitychange",k);var $e={setup:()=>{var e,t,o,a,i,l;for(a=["all 屏幕+摄像头录制","screen 屏幕录制","camera 摄像头录制"],l=t=0,o=a.length;t<o;l=++t)e=a[l],i=e.indexOf(" "),a[l]=[e.slice(0,i),e.slice(1+i)];return K(()=>r.src,k),U(k),K(()=>r.video,n=>{var d;document.hidden||({src:d}=r,n?d==="screen"&&(r.src=localStorage.src||"all"):d!=="screen"&&(localStorage.src=r.src,r.src="screen"),k())}),{li:a,config:r,go:n=>{r.src=n,te()}}}};const Se=e=>(x("data-v-af4c0d26"),e=e(),V(),e),ke={class:"method"},we=["onClick"],Ce=Se(()=>s("b",{class:"ico"},null,-1));function Ie(e,t){return c(),u("div",ke,[(c(!0),u(w,null,L(e.li,([o,a])=>(c(),u("a",{class:X([o,e.config.src==o?"now":"",e.config.no_video_src==!0?"forbidden":""]),onClick:i=>e.go(o)},[Ce,s("i",null,y(a),1)],10,we))),256))])}var xe=g($e,[["render",Ie],["__scopeId","data-v-af4c0d26"]]),Ve={setup:()=>({config:r,disabled:de(()=>r.src==="camera"),li:"整个桌面 应用窗口 指定区域".split(" ")})};const Re=e=>(x("data-v-cf47a3ec"),e=e(),V(),e),ze={class:"bk"},Le=Re(()=>s("h2",null,"录制区域",-1)),Me={class:"select"},Ee=["disabled"],Be=["value"];function Ue(e,t){return c(),u("div",ze,[Le,s("div",Me,[C(s("select",{disabled:e.disabled,"onUpdate:modelValue":t[0]||(t[0]=o=>e.config.area=o)},[(c(!0),u(w,null,L(e.li,(o,a)=>(c(),u("option",{value:a},y(o),9,Be))),256))],8,Ee),[[E,e.config.area]])])])}var Te=g(Ve,[["render",Ue],["__scopeId","data-v-cf47a3ec"]]),S;S="PreOfRec";var De={components:{zAudio:ve},setup:()=>{var e,t,o,a;return a={audio:M([]),video:M([])},{mediaDevices:e}=navigator,o=i=>{i==="audio"?r[i]?p(S,"MikeSwitch.Click"):p(S,"MikeClose.Click"):r[i]?p(S,"CamSwitch.Click"):p(S,"CamClose.Click")},t=async()=>{var i,l,n,d,N,h,R,O,P,A,F,_,f,b,W,j,H;R={},f={audio:{exist:!1,default_id:""},video:{exist:!1,default_id:""}},P=await e.enumerateDevices();for(W of P)({kind:d,label:h,deviceId:i}=W),i==="default"&&(h=h.replace("Default - ",""),h="默认 "+h),d.endsWith("input")&&(d=d.slice(0,-5),(R[d]=R[d]||[]).push([i,h]),localStorage[d]===i&&(f[d].exist=!0),(f[d].default_id===""||i==="default")&&(f[d].default_id=i));for(n in a)a[n].value=R[n]||[];for(n in a){if({value:b}=a[n],b.length){if(_=r[n],_){for(j of b)if([l]=j,_===l)return}if(_!==""){for(H of b){if([l,N]=H,_)break;if(l==="default"){_=l;break}O=N.toLowerCase(),A=["default","built-in","内建","默认"];for(F of A)if(O.includes(F)){_=l;break}}_||(_=b[0][0])}}else _="";r[n]=_}for(n in f)f[n].exist||(localStorage.removeItem(n),r[n]?localStorage[n]=r[n]:f[n].default_id!==""&&(localStorage[n]=f[n].default_id));r.no_video_src=!localStorage.video},T(()=>{var i,l,n;l=["audio","video"];for(i of l)n=r[i],n&&(localStorage[i]=n)}),(async()=>await t())(),G({refresh:t,report:o,config:r,x:i=>{var l;l=r[i],l?l="":l=localStorage[i]||"",r[i]=l,o(i)}},a)}};const D=e=>(x("data-v-8ed2a518"),e=e(),V(),e),Ne={class:"bk"},Oe=D(()=>s("h2",null,"设备设置",-1)),Pe={class:"video"},Ae={class:"select"},Fe={label:"输入源"},We=["value"],je=D(()=>s("optgroup",{label:"───"},[s("option",{value:""},"禁用")],-1)),He={class:"audio"},qe={class:"select"},Je={label:"输入源"},Ge=["value"],Ke=D(()=>s("optgroup",{label:"───"},[s("option",{value:""},"禁用")],-1));function Qe(e,t){const o=v("z-audio");return c(),u("div",Ne,[Oe,s("li",Pe,[s("label",{class:X({x:!e.config.video}),onClick:t[0]||(t[0]=a=>e.x("video")),for:"driveVideo"},null,2),s("div",Ae,[C(s("select",{id:"driveVideo",onFocus:t[1]||(t[1]=(...a)=>e.refresh&&e.refresh(...a)),"onUpdate:modelValue":t[2]||(t[2]=a=>e.config.video=a),onChange:t[3]||(t[3]=a=>e.report("video"))},[s("optgroup",Fe,[(c(!0),u(w,null,L(e.video,([a,i])=>(c(),u("option",{value:a},y(i),9,We))),256))]),je],544),[[E,e.config.video]])])]),s("li",He,[s("label",{onClick:t[4]||(t[4]=a=>e.x("audio")),for:"driveAudio"},[m(o)]),s("div",qe,[C(s("select",{id:"driveAudio",onFocus:t[5]||(t[5]=(...a)=>e.refresh&&e.refresh(...a)),"onUpdate:modelValue":t[6]||(t[6]=a=>e.config.audio=a),onChange:t[7]||(t[7]=a=>e.report("audio"))},[s("optgroup",Je,[(c(!0),u(w,null,L(e.audio,([a,i])=>(c(),u("option",{value:a},y(i),9,Ge))),256))]),Ke],544),[[E,e.config.audio]])])])])}var Xe=g(De,[["render",Qe],["__scopeId","data-v-8ed2a518"]]),oe,ae;({auto_start:oe}=I);ae=pe==="win32";var Ye={setup:()=>{var e,t;return localStorage.getItem("sys_audio")===null&&(r.sys_audio=!0),localStorage.getItem("auto_start")===null&&(r.auto_start=!0),t=window.innerWidth,e=window.innerHeight,T(()=>{var o,a,i;a=["sys_audio","auto_start"];for(o of a)i=r[o],localStorage[o]=i;oe.auto_start(r.auto_start)}),{config:r,isWin:ae,toggle:()=>(document.getElementById("extra").classList.toggle("active"),document.getElementById("extra-setting").classList.toggle("active"),document.getElementById("extra").classList.contains("active")?window.resizeTo(t,e+35):window.resizeTo(t,e))}}};const re=e=>(x("data-v-56178e42"),e=e(),V(),e),Ze={class:"bk"},et={id:"extra-setting"},tt={key:0,class:"box"},ot=re(()=>s("label",{for:"sys-audio"},"录制系统声音",-1)),at={class:"box"},rt=re(()=>s("label",{for:"auto-start"},"开机自动启动",-1));function it(e,t){return c(),u("div",Ze,[s("h2",{id:"extra",onClick:t[0]||(t[0]=(...o)=>e.toggle&&e.toggle(...o))},"其他设置"),s("li",et,[e.isWin?(c(),u("div",tt,[C(s("input",{id:"sys-audio",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=o=>e.config.sys_audio=o)},null,512),[[Q,e.config.sys_audio]]),ot])):ce("",!0),s("div",at,[C(s("input",{id:"auto-start",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>e.config.auto_start=o)},null,512),[[Q,e.config.auto_start]]),rt])])])}var st=g(Ye,[["render",it],["__scopeId","data-v-56178e42"]]),nt={components:{btn:me}};const lt=e=>(x("data-v-b0e482fa"),e=e(),V(),e),dt=lt(()=>s("b",null,null,-1));function ct(e,t){const o=v("btn");return c(),ue(o,null,{default:Y(()=>[dt,_e(e.$slots,"default",{},void 0,!0)]),_:3})}var ut=g(nt,[["render",ct],["__scopeId","data-v-b0e482fa"]]),_t={setup:()=>{var e;return e=M('单次最长录制30分钟, "扩容"可获更长时间'),U(async()=>{await ge()}),T(()=>{r.duration_txt&&(e.value=r.duration_txt)}),{txt:e,pay:()=>I.open(Z+"?pay=true&user_token="+localStorage.uid)}}};function ft(e,t){return c(),u("a",{onClick:t[0]||(t[0]=(...o)=>e.pay&&e.pay(...o))},y(e.txt),1)}var vt=g(_t,[["render",ft],["__scopeId","data-v-234a3262"]]),B,ie;({auto_update:ie}=I);B="PreOfRec";var pt={components:{src:xe,rArea:Te,drive:Xe,extra:st,btn:ut,durationLimit:vt},setup:()=>{var e,t;return t="开始录制",e=M(t),U(()=>{p(B,"RecPop.View")}),{txt:e,start:async()=>{var o,a,i;localStorage.recing=1,{avatarUrl:o,space:{used:i,max:a}}=await he.json("user/get"),localStorage.ico=o,i>=a?(e.value="请付费扩容后点此录制",I.open(Z+"?pay=true&user_token="+localStorage.uid)):(e.value=t,be(B,"RecStart.Click",JSON.stringify({src:r.src,area:r.area,audio:!!r.audio,video:!!r.video})),ye())}}}};(async()=>await ie.update_promise())();function mt(e,t){const o=v("src"),a=v("r-area"),i=v("drive"),l=v("extra"),n=v("btn"),d=v("durationLimit");return c(),u(w,null,[m(o),s("main",null,[m(a),m(i),m(l),m(n,{onClick:e.start},{default:Y(()=>[fe(y(e.txt),1)]),_:1},8,["onClick"]),m(d)])],64)}var Mt=g(pt,[["render",mt],["__scopeId","data-v-f2014a82"]]);export{Mt as default};
