import b from"./h.js";import{c as o}from"./r.js";import{b as y,g as S,m as h}from"./$4.js";import{v}from"./t.js";import{i as e}from"./4.js";import{k as q,J as M}from"./f.js";import"./3.js";import"./0.js";import"./..js";import"./k.js";import"./$2.js";import"./1.js";import"./s.js";import"./_.js";function T(){return new Worker("/$$.js",{type:"module"})}var l,m,u,c,s,n,a,d,w,k,g,f,_,i;({camera:n}=e);u={};s=!1;try{k=await v()}catch(r){a=r,console.error("capture desktop failed",a),await e.confirm.show_err("屏幕录制失败","屏幕录制失败，请授权或咨询客服。",{错误信息:""+a}),e.recbar.send_quick_stop()}i=k.getVideoTracks()[0];({area:l}=o);l&&(_=new MediaStreamTrackProcessor({track:i,maxBufferSize:15}),i=new MediaStreamTrackGenerator({kind:"video"}),d=[_.readable,i.writable],w=()=>{new T().postMessage([localStorage.ppi-0,...d,...JSON.parse(localStorage.area)],d)});i.contentHint="detail";try{m=await y(),s=!0}catch(r){a=r,s=!1,console.error("failed to get audio from:",localStorage.audio,"err:",a),u={错误信息:""+a,设备信息:localStorage.audio}}c=m?m.getTracks():[];try{f=await S(o.sys_audio)}catch(r){a=r,console.error("系统音频获取失败:",a),await e.confirm.show_err("系统音频获取失败","系统音频获取失败，请授权或咨询客服。",{错误信息:""+a},"停止录制",""),e.recbar.send_quick_stop()}g=new MediaStream([i,...h(c,f)]);q(async()=>{var r,t,p;r=!!o.audio;for(t of c)t.enabled=r;r&&!s&&(await e.confirm.show_err("音频获取失败","音频获取失败，请授权或咨询客服。",u)?e.recbar.send_quick_stop():e.recbar.send_quick_resume(),o.audio=""),p=o.sys_audio;for(t of f)t.enabled=p});M(()=>o.video,async()=>{var r;({video:r}=o),r?await n.show(localStorage.face_area_size-0):await n.hide()});b(g,c,w);
