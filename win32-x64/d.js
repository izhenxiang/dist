var le=Object.defineProperty;var J=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var G=(e,t,o)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,K=(e,t)=>{for(var o in t||(t={}))de.call(t,o)&&G(e,o,t[o]);if(J)for(var o of J(t))ce.call(t,o)&&G(e,o,t[o]);return e};import{c as r}from"./l.js";import{i as x}from"./4.js";import{H as Q,o as U,d as c,a as u,N as S,R as E,m as Y,e as s,t as $,p as I,i as L,_ as h,z as ue,L as C,S as M,s as R,k as N,b as v,f as g,U as X,x as _e,c as fe,w as Z,j as ve,h as pe}from"./f.js";import{z as me}from"./j.js";import{p as ge}from"./a.js";import{b as he}from"./t.js";import{a as ee,u as be}from"./$2.js";import{H as te}from"./o.js";import{s as ye}from"./.js";import"./y.js";import"./n.js";import"./2.js";import"./..js";import"./r.js";var m=function(e,t){_paq.push(["trackEvent",e,t,"",""])},$e=function(e,t,o){_paq.push(["trackEvent",e,t,"","",o])},z,T,p,oe,ae,y;({camera:p,main:oe}=x);z="PreOfRec";y=()=>{var e,t;if(gc(),document.hidden){localStorage.recing||p.x();return}switch(delete localStorage.recing,{src:e}=r,p.x(),e){case"screen":r.video="";break;default:if(!r.video){if({video:t}=localStorage,!t){r.src="screen";return}r.video=t}e==="all"?(p.circle(localStorage.face_area_size-0),p.top_once()):(p.rect(),p.top_once()),setTimeout(()=>{document.hidden||oe(!1)},1e3)}};ae=()=>{var e;switch({src:e}=r,e){case"all":m(z,"RecMode.Scr&Cam.Click");break;case"screen":m(z,"RecMode.Scr.Click");break;default:m(z,"RecMode.Cam.Click")}};document.addEventListener("visibilitychange",()=>{if(y(),!navigator.onLine)return T()});T=()=>{gc(),localStorage.recing||p.x()};window.addEventListener("online",()=>{y()});window.addEventListener("offline",()=>{T()});var we={setup:()=>{var e,t,o,a,i,l;for(a=["all 屏幕+摄像头录制","screen 屏幕录制","camera 摄像头录制"],l=t=0,o=a.length;t<o;l=++t)e=a[l],i=e.indexOf(" "),a[l]=[e.slice(0,i),e.slice(1+i)];return Q(()=>r.src,y),U(y),Q(()=>r.video,n=>{var d;document.hidden||({src:d}=r,n?d==="screen"&&(r.src=localStorage.src||"all"):d!=="screen"&&(localStorage.src=r.src,r.src="screen"),y())}),{li:a,config:r,go:n=>{r.src=n,ae()}}}};const ke=e=>(I("data-v-064c212e"),e=e(),L(),e),Se={class:"method"},Ce=["onClick"],xe=ke(()=>s("b",{class:"ico"},null,-1));function Ie(e,t){return c(),u("div",Se,[(c(!0),u(S,null,E(e.li,([o,a])=>(c(),u("a",{class:Y([o,e.config.src==o?"now":"",e.config.no_video_src==!0?"forbidden":""]),onClick:i=>e.go(o)},[xe,s("i",null,$(a),1)],10,Ce))),256))])}var Le=h(we,[["render",Ie],["__scopeId","data-v-064c212e"]]),Ve={setup:()=>({config:r,disabled:ue(()=>r.src==="camera"),li:"整个桌面 应用窗口 指定区域".split(" ")})};const ze=e=>(I("data-v-cf47a3ec"),e=e(),L(),e),Ee={class:"bk"},Re=ze(()=>s("h2",null,"录制区域",-1)),Me={class:"select"},Be=["disabled"],Ue=["value"];function Ne(e,t){return c(),u("div",Ee,[Re,s("div",Me,[C(s("select",{disabled:e.disabled,"onUpdate:modelValue":t[0]||(t[0]=o=>e.config.area=o)},[(c(!0),u(S,null,E(e.li,(o,a)=>(c(),u("option",{value:a},$(o),9,Ue))),256))],8,Be),[[M,e.config.area]])])])}var Te=h(Ve,[["render",Ne],["__scopeId","data-v-cf47a3ec"]]),k;k="PreOfRec";var De={components:{zAudio:me},setup:()=>{var e,t,o,a;return a={audio:R([]),video:R([])},{mediaDevices:e}=navigator,o=i=>{i==="audio"?r[i]?m(k,"MikeSwitch.Click"):m(k,"MikeClose.Click"):r[i]?m(k,"CamSwitch.Click"):m(k,"CamClose.Click")},t=async()=>{var i,l,n,d,O,b,V,P,A,H,W,_,f,w,j,F,q;V={},f={audio:{exist:!1,default_id:""},video:{exist:!1,default_id:""}},A=await e.enumerateDevices();for(j of A)({kind:d,label:b,deviceId:i}=j),i==="default"&&(b=b.replace("Default - ",""),b="默认 "+b),d.endsWith("input")&&(d=d.slice(0,-5),(V[d]=V[d]||[]).push([i,b]),localStorage[d]===i&&(f[d].exist=!0),(f[d].default_id===""||i==="default")&&(f[d].default_id=i));for(n in a)a[n].value=V[n]||[];for(n in a){if({value:w}=a[n],w.length){if(_=r[n],_){for(F of w)if([l]=F,_===l)return}if(_!==""){for(q of w){if([l,O]=q,_)break;if(l==="default"){_=l;break}P=O.toLowerCase(),H=["default","built-in","内建","默认"];for(W of H)if(P.includes(W)){_=l;break}}_||(_=w[0][0])}}else _="";r[n]=_}for(n in f)f[n].exist||(localStorage.removeItem(n),r[n]?localStorage[n]=r[n]:f[n].default_id!==""&&(localStorage[n]=f[n].default_id));r.no_video_src=!localStorage.video},N(()=>{var i,l,n;l=["audio","video"];for(i of l)n=r[i],n&&(localStorage[i]=n)}),(async()=>await t())(),K({refresh:t,report:o,config:r,x:i=>{var l;l=r[i],l?l="":l=localStorage[i]||"",r[i]=l,o(i)}},a)}};const D=e=>(I("data-v-588cc943"),e=e(),L(),e),Oe={class:"bk"},Pe=D(()=>s("h2",null,"设备设置",-1)),Ae={class:"video"},He={class:"select"},We={label:"输入源"},je=["value"],Fe=D(()=>s("optgroup",{label:"───"},[s("option",{value:""},"禁用")],-1)),qe={class:"audio"},Je={class:"select"},Ge={label:"输入源"},Ke=["value"],Qe=D(()=>s("optgroup",{label:"───"},[s("option",{value:""},"禁用")],-1));function Xe(e,t){const o=v("z-audio");return c(),u("div",Oe,[Pe,s("li",Ae,[s("label",{class:Y({x:!e.config.video}),onClick:t[0]||(t[0]=a=>e.x("video")),for:"driveVideo"},null,2),s("div",He,[C(s("select",{id:"driveVideo",onFocus:t[1]||(t[1]=(...a)=>e.refresh&&e.refresh(...a)),"onUpdate:modelValue":t[2]||(t[2]=a=>e.config.video=a),onChange:t[3]||(t[3]=a=>e.report("video"))},[s("optgroup",We,[(c(!0),u(S,null,E(e.video,([a,i])=>(c(),u("option",{value:a},$(i),9,je))),256))]),Fe],544),[[M,e.config.video]])])]),s("li",qe,[s("label",{onClick:t[4]||(t[4]=a=>e.x("audio")),for:"driveAudio"},[g(o)]),s("div",Je,[C(s("select",{id:"driveAudio",onFocus:t[5]||(t[5]=(...a)=>e.refresh&&e.refresh(...a)),"onUpdate:modelValue":t[6]||(t[6]=a=>e.config.audio=a),onChange:t[7]||(t[7]=a=>e.report("audio"))},[s("optgroup",Ge,[(c(!0),u(S,null,E(e.audio,([a,i])=>(c(),u("option",{value:a},$(i),9,Ke))),256))]),Qe],544),[[M,e.config.audio]])])])])}var Ye=h(De,[["render",Xe],["__scopeId","data-v-588cc943"]]),re,ie;({auto_start:re}=x);ie=ge==="win32";var Ze={setup:()=>{var e,t;return r.sys_audio===void 0&&(r.sys_audio=!0),r.auto_start===void 0&&(r.auto_start=!0),t=window.innerWidth,e=window.innerHeight,N(()=>{var o,a,i;a=["sys_audio","auto_start"];for(o of a)i=r[o],localStorage[o]=i;re.auto_start(r.auto_start)}),{config:r,isWin:ie,toggle:()=>(document.getElementById("extra").classList.toggle("active"),document.getElementById("extra-setting").classList.toggle("active"),document.getElementById("extra").classList.contains("active")?window.resizeTo(t,e+35):window.resizeTo(t,e))}}};const se=e=>(I("data-v-4ebae813"),e=e(),L(),e),et={class:"bk"},tt={id:"extra-setting"},ot={key:0,class:"box"},at=se(()=>s("label",{for:"sys-audio"},"录制系统声音",-1)),rt={class:"box"},it=se(()=>s("label",{for:"auto-start"},"开机自动启动",-1));function st(e,t){return c(),u("div",et,[s("h2",{id:"extra",onClick:t[0]||(t[0]=(...o)=>e.toggle&&e.toggle(...o))},"其他设置"),s("li",tt,[e.isWin?(c(),u("div",ot,[C(s("input",{id:"sys-audio",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=o=>e.config.sys_audio=o)},null,512),[[X,e.config.sys_audio]]),at])):_e("",!0),s("div",rt,[C(s("input",{id:"auto-start",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>e.config.auto_start=o)},null,512),[[X,e.config.auto_start]]),it])])])}var nt=h(Ze,[["render",st],["__scopeId","data-v-4ebae813"]]),lt={components:{btn:he}};const dt=e=>(I("data-v-b0e482fa"),e=e(),L(),e),ct=dt(()=>s("b",null,null,-1));function ut(e,t){const o=v("btn");return c(),fe(o,null,{default:Z(()=>[ct,ve(e.$slots,"default",{},void 0,!0)]),_:3})}var _t=h(lt,[["render",ut],["__scopeId","data-v-b0e482fa"]]),ft={setup:()=>{var e;return e=R('单次最长录制30分钟, "扩容"可获更长时间'),U(async()=>{await ee()}),N(()=>{r.duration_txt&&(e.value=r.duration_txt)}),{txt:e,pay:()=>x.open(te+"?pay=true&user_token="+localStorage.uid)}}};function vt(e,t){return c(),u("a",{onClick:t[0]||(t[0]=(...o)=>e.pay&&e.pay(...o))},$(e.txt),1)}var pt=h(ft,[["render",vt],["__scopeId","data-v-234a3262"]]),B,ne;({auto_update:ne}=x);B="PreOfRec";var mt={components:{src:Le,rArea:Te,drive:Ye,extra:nt,btn:_t,durationLimit:pt},setup:()=>{var e,t;return t="开始录制",e=R(t),U(()=>{m(B,"RecPop.View")}),{txt:e,start:async()=>{var o,a,i;localStorage.recing=1,{avatarUrl:o,space:{used:i,max:a}}=await be.json("user/get"),await ee(),localStorage.ico=o,i>=a?(e.value="请付费扩容后点此录制",x.open(te+"?pay=true&user_token="+localStorage.uid)):(e.value=t,$e(B,"RecStart.Click",JSON.stringify({src:r.src,area:r.area,audio:!!r.audio,video:!!r.video})),ye())}}}};(async()=>await ne.update_promise())();function gt(e,t){const o=v("src"),a=v("r-area"),i=v("drive"),l=v("extra"),n=v("btn"),d=v("durationLimit");return c(),u(S,null,[g(o),s("main",null,[g(a),g(i),g(l),g(n,{onClick:e.start},{default:Z(()=>[pe($(e.txt),1)]),_:1},8,["onClick"]),g(d)])],64)}var Mt=h(mt,[["render",gt],["__scopeId","data-v-cc5225a6"]]);export{Mt as default};
