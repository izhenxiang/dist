"use strict";var Pn=Object.defineProperty,Un=Object.defineProperties;var An=Object.getOwnPropertyDescriptors;var Xt=Object.getOwnPropertySymbols;var Bn=Object.prototype.hasOwnProperty,Wn=Object.prototype.propertyIsEnumerable;var Yt=(t,e,r)=>e in t?Pn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Me=(t,e)=>{for(var r in e||(e={}))Bn.call(e,r)&&Yt(t,r,e[r]);if(Xt)for(var r of Xt(e))Wn.call(e,r)&&Yt(t,r,e[r]);return t},Qt=(t,e)=>Un(t,An(e));var m=require("electron"),jn=require("os"),oe=require("fs"),V=require("path"),In=require("crypto"),mr=require("zlib"),En=require("util"),ue=require("./q.js"),Ue=require("fs/promises"),Ve=require("./$3.js"),vr=require("./o.js"),ae=require("./9.js"),Dn=require("events");function br(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var ge=br(jn),zn=br(Dn),Cn="win32",ie=t=>{if(!!t&&!t.isDestroyed()){t.close();try{t.destroy()}catch{}}},$n=(t,e)=>{var r,n;for(r in e)n=e[r],t.on(r,n);return t},_r;_r=V.dirname(__dirname);_t=bt=vt=__dirname;V.dirname(_r);var vt=vt,bt=bt,_t=_t,ot,Sr;ot="127.0.0.1",Sr="http://"+ot,m.session.defaultSession.protocol.interceptStreamProtocol("http",(t,e)=>{var r,n,i,s,f,w,p,v,k;if(k=new URL(t.url),k.host===ot)({pathname:f}=k),f==="/"&&(f+=".htm"),v=f.slice(f.lastIndexOf(".")+1),v.startsWith("htm")?s="text/html":s={js:"text/javascript",css:"text/css",svg:"image/svg+xml",woff2:"font/woff2"}[v]||"application/octet-stream",n=oe.createReadStream(bt+f),e({data:n,statusCode:200,headers:{"content-type":s}});else{if(t.useSessionCookies=!0,t.partition="persist:I",w=m.net.request(t),w.on("response",S=>{var A,U;({headers:A,statusCode:U}=S),e({data:S},A,U)}),t.uploadData){p=t.uploadData;for(i of p)({bytes:r}=i),r&&w.write(r)}w.end()}});var de=new Proxy({},{get:(t,e)=>r=>{var n;return r=Qt(Me({skipTaskbar:!0,frame:!1,minimizable:!1,maximizable:!1,fullscreenable:!1,type:"toolbar",shadow:!1,hasShadow:!1,transparent:!0},r),{webPreferences:Me({preload:V.join(vt,"$!.js"),webSecurity:!1},r.webPreferences)}),n=new m.BrowserWindow(r),n.setMenu(null),e!=="main"&&n.setVisibleOnAllWorkspaces(!0,{visibleOnFullScreen:!0}),n.loadURL(Sr+"#"+e),n.once("ready-to-show",()=>{n.show()}),n.focus(),n}}),Ke=t=>{m.BrowserWindow.getAllWindows().forEach(e=>{var r,n;if(n=e.webContents.getURL(),n){if({hash:r}=new URL(n),r=r.slice(1),r.startsWith("main")){t?(e[t](),t==="show"&&e.once("show",()=>{e.setAlwaysOnTop(!0,"screen-saver"),setTimeout(()=>e.setAlwaysOnTop(!1,"screen-saver"),1e3)})):e.hide();return}if(r.startsWith("camera"))return}ie(e)})},kr=()=>{m.BrowserWindow.getAllWindows().forEach(t=>{var e,r;if(r=t.webContents.getURL(),r&&({hash:e}=new URL(r),e=e.slice(1),e.startsWith("main"))){t.hide();return}ie(t)})},Rn="帧想",Or,Tr;({main:Or}=de);Tr=function(t=!0){var e,r,n,i;if(r=m.BrowserWindow.getAllWindows(),r.length)for(e of r)switch(n=e.webContents.getURL().split("/#").pop(),n){case"main":i=e;break;case"recbar":case"win_area":case"area":return}i?(i.isMinimized(),i.restore()):(i=Or({type:"",resizable:!1,height:610,width:426,skipTaskbar:!1}),i.setAppDetails({appId:Rn,appIconPath:process.execPath}),i.on("close",s=>{m.app.quiting||(s.preventDefault(),kr())})),!(!t&&!i.isVisible())&&(i.show(),i.moveTop(),i.focus())};function ce(t=!0){return Tr(t)}var Ln=function(){var t,e,r,n;if(n=void 0,e=m.BrowserWindow.getAllWindows(),e.length)for(t of e)switch(r=t.webContents.getURL().split("/#").pop(),r){case"main":n=t;break;case"recbar":case"win_area":case"area":return}if(n!==void 0)return n.webContents.send("quick_start","start")},St,me,Xe,Mr,Se,Ae,Ne,Ge,re,y,kt;({camera:Mr}=de);y=void 0;re=void 0;St=204;me=30;Ae=Se=St;var Pr=()=>{y&&!y.isDestroyed()&&y.getSize()[0]!==800&&(re=y.getPosition()),ie(y),y=void 0},Fn=t=>{var e,r;Ae=t,Se=t+me,r=y.getSize()[0],r!==t&&(re=y.getPosition(),e=Math.round((t-r)/2),y.setBounds({x:re[0]-e,y:re[1]-e,width:Ae,height:Se}))};Xe=!1;var Ur=()=>kt(800,500+me);Ne=Se;Ge=[];var qn=function(){if(!y||y.isDestroyed())return 0;Ne=y.getSize()[1],Ge=y.getPosition()},Vn=function(){return!!(!y||y.isDestroyed())},Nn=function(t){var e,r,n,i;if(!(!y||y.isDestroyed()))try{if(e=Ae/(Se-me),n=Ne+t,n<=200)return;i=parseInt(e*(n-me)+.5),y.setBounds({x:Ge[0],y:Ge[1]-t,width:i,height:n})}catch(s){r=s,console.error("resize camera failed",t,Ne,r)}},Gn=kt=(t,e)=>{y&&!y.isDestroyed()||(e<=400&&(e+=me),Ae=t,Se=e,y=Mr({width:t,height:e,center:!0,roundedCorners:!1,resizable:!1,transparent:!0}),Xe&&Be())},Ar=t=>{var e,r,n,i,s;y&&!y.isDestroyed()||(t=t||St,kt(t,t),re&&re[0]>=0&&re[1]>=0?[e,r]=re:({width:s,height:n}=m.screen.getPrimaryDisplay().size,i=62+me+5,e=i,r=n-i-t),y.setPosition(e,r))},Jn=()=>{Pr(),Ur()},Be=()=>{y&&!y.isDestroyed()&&(y.setAlwaysOnTop(!0,"pop-up-menu"),y.setVisibleOnAllWorkspaces(!0,{visibleOnFullScreen:!0})),Xe=!0},Hn=()=>{y&&!y.isDestroyed()&&y.moveTop()},Br=()=>{y&&!y.isDestroyed()&&(y.setAlwaysOnTop(!1),y.setVisibleOnAllWorkspaces(!1)),Xe=!1},Wr=function(){return y},Zn=function(){y&&!y.isDestroyed()&&y.hide()},Kn=function(t){y&&!y.isDestroyed()?(y.show(),Be()):(Ar(t),Be())},Xn=Object.freeze(Object.defineProperty({__proto__:null,x:Pr,size:Fn,rect:Ur,record_ori_height:qn,camera_destroyed:Vn,zoom_window:Nn,default:Gn,circle:Ar,x_rect:Jn,top:Be,top_once:Hn,untop:Br,get_camera_win:Wr,hide:Zn,show:Kn},Symbol.toStringTag,{value:"Module"})),Yn="x64",ut;try{ut=new TextDecoder}catch{}var h,fe,o=0,N={},P,le,H=0,Y=0,L,ne,G=[],M,er={useRecords:!1,mapsAsObjects:!0};class jr{}const Ir=new jr;Ir.name="MessagePack 0xC1";var ke=!1,Er=2;try{new Function("")}catch{Er=1/0}class We{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,r){if(h)return Lr(()=>(dt(),this?this.unpack(e,r):We.prototype.unpack.call(er,e,r)));fe=r>-1?r:e.length,o=0,Y=0,le=null,L=null,h=e;try{M=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(n){throw h=null,e instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof We){if(N=this,this.structures)return P=this.structures,Ce();(!P||P.length>0)&&(P=[])}else N=er,(!P||P.length>0)&&(P=[]);return Ce()}unpackMultiple(e,r){let n,i=0;try{ke=!0;let s=e.length,f=this?this.unpack(e,s):Ye.unpack(e,s);if(r){for(r(f);o<s;)if(i=o,r(Ce())===!1)return}else{for(n=[f];o<s;)i=o,n.push(Ce());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{ke=!1,dt()}}_mergeStructures(e,r){e=e||[];for(let n=0,i=e.length;n<i;n++){let s=e[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}e.sharedLength=e.length;for(let n in r||[])if(n>=0){let i=e[n],s=r[n];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[n]=i),e[n]=s)}return this.structures=e}decode(e,r){return this.unpack(e,r)}}function Ce(){try{if(!N.trusted&&!ke){let e=P.sharedLength||0;e<P.length&&(P.length=e)}let t=D();if(L&&(o=L.postBundlePosition),o==fe)P.restoreStructures&&tr(),P=null,h=null,ne&&(ne=null);else if(o>fe){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}else if(!ke)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw P.restoreStructures&&tr(),dt(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function tr(){for(let t in P.restoreStructures)P[t]=P.restoreStructures[t];P.restoreStructures=null}function D(){let t=h[o++];if(t<160)if(t<128){if(t<64)return t;{let e=P[t&63]||N.getStructures&&Dr()[t&63];return e?(e.read||(e.read=Ot(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,N.mapsAsObjects){let e={};for(let r=0;r<t;r++)e[Cr()]=D();return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(D(),D());return e}else{t-=144;let e=new Array(t);for(let r=0;r<t;r++)e[r]=D();return e}else if(t<192){let e=t-160;if(Y>=o)return le.slice(o-H,(o+=e)-H);if(Y==0&&fe<140){let r=e<16?Tt(e):zr(e);if(r!=null)return r}return ct(e)}else{let e;switch(t){case 192:return null;case 193:return L?(e=D(),e>0?L[1].slice(L.position1,L.position1+=e):L[0].slice(L.position0,L.position0-=e)):Ir;case 194:return!1;case 195:return!0;case 196:return at(h[o++]);case 197:return e=M.getUint16(o),o+=2,at(e);case 198:return e=M.getUint32(o),o+=4,at(e);case 199:return xe(h[o++]);case 200:return e=M.getUint16(o),o+=2,xe(e);case 201:return e=M.getUint32(o),o+=4,xe(e);case 202:if(e=M.getFloat32(o),N.useFloat32>2){let r=Mt[(h[o]&127)<<1|h[o+1]>>7];return o+=4,(r*e+(e>0?.5:-.5)>>0)/r}return o+=4,e;case 203:return e=M.getFloat64(o),o+=8,e;case 204:return h[o++];case 205:return e=M.getUint16(o),o+=2,e;case 206:return e=M.getUint32(o),o+=4,e;case 207:return N.int64AsNumber?(e=M.getUint32(o)*4294967296,e+=M.getUint32(o+4)):e=M.getBigUint64(o),o+=8,e;case 208:return M.getInt8(o++);case 209:return e=M.getInt16(o),o+=2,e;case 210:return e=M.getInt32(o),o+=4,e;case 211:return N.int64AsNumber?(e=M.getInt32(o)*4294967296,e+=M.getUint32(o+4)):e=M.getBigInt64(o),o+=8,e;case 212:if(e=h[o++],e==114)return ar(h[o++]&63);{let r=G[e];if(r)return r.read?(o++,r.read(D())):r.noBuffer?(o++,r()):r(h.subarray(o,++o));throw new Error("Unknown extension "+e)}case 213:return e=h[o],e==114?(o++,ar(h[o++]&63,h[o++])):xe(2);case 214:return xe(4);case 215:return xe(8);case 216:return xe(16);case 217:return e=h[o++],Y>=o?le.slice(o-H,(o+=e)-H):ei(e);case 218:return e=M.getUint16(o),o+=2,Y>=o?le.slice(o-H,(o+=e)-H):ti(e);case 219:return e=M.getUint32(o),o+=4,Y>=o?le.slice(o-H,(o+=e)-H):ri(e);case 220:return e=M.getUint16(o),o+=2,nr(e);case 221:return e=M.getUint32(o),o+=4,nr(e);case 222:return e=M.getUint16(o),o+=2,ir(e);case 223:return e=M.getUint32(o),o+=4,ir(e);default:if(t>=224)return t-256;if(t===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+t)}}}const Qn=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Ot(t,e){function r(){if(r.count++>Er){let i=t.read=new Function("r","return function(){return {"+t.map(s=>Qn.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(D);return t.highByte===0&&(t.read=rr(e,t.read)),i()}let n={};for(let i=0,s=t.length;i<s;i++){let f=t[i];n[f]=D()}return n}return r.count=0,t.highByte===0?rr(e,r):r}const rr=(t,e)=>function(){let r=h[o++];if(r===0)return e();let n=t<32?-(t+(r<<5)):t+(r<<5),i=P[n]||Dr()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=Ot(i,t)),i.read()};function Dr(){let t=Lr(()=>(h=null,N.getStructures()));return P=N._mergeStructures(t,P)}var ct=De,ei=De,ti=De,ri=De;function De(t){let e;if(t<16&&(e=Tt(t)))return e;if(t>64&&ut)return ut.decode(h.subarray(o,o+=t));const r=o+t,n=[];for(e="";o<r;){const i=h[o++];if((i&128)===0)n.push(i);else if((i&224)===192){const s=h[o++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=h[o++]&63,f=h[o++]&63;n.push((i&31)<<12|s<<6|f)}else if((i&248)===240){const s=h[o++]&63,f=h[o++]&63,w=h[o++]&63;let p=(i&7)<<18|s<<12|f<<6|w;p>65535&&(p-=65536,n.push(p>>>10&1023|55296),p=56320|p&1023),n.push(p)}else n.push(i);n.length>=4096&&(e+=$.apply(String,n),n.length=0)}return n.length>0&&(e+=$.apply(String,n)),e}function nr(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=D();return e}function ir(t){if(N.mapsAsObjects){let e={};for(let r=0;r<t;r++)e[Cr()]=D();return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(D(),D());return e}}var $=String.fromCharCode;function zr(t){let e=o,r=new Array(t);for(let n=0;n<t;n++){const i=h[o++];if((i&128)>0){o=e;return}r[n]=i}return $.apply(String,r)}function Tt(t){if(t<4)if(t<2){if(t===0)return"";{let e=h[o++];if((e&128)>1){o-=1;return}return $(e)}}else{let e=h[o++],r=h[o++];if((e&128)>0||(r&128)>0){o-=2;return}if(t<3)return $(e,r);let n=h[o++];if((n&128)>0){o-=3;return}return $(e,r,n)}else{let e=h[o++],r=h[o++],n=h[o++],i=h[o++];if((e&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){o-=4;return}if(t<6){if(t===4)return $(e,r,n,i);{let s=h[o++];if((s&128)>0){o-=5;return}return $(e,r,n,i,s)}}else if(t<8){let s=h[o++],f=h[o++];if((s&128)>0||(f&128)>0){o-=6;return}if(t<7)return $(e,r,n,i,s,f);let w=h[o++];if((w&128)>0){o-=7;return}return $(e,r,n,i,s,f,w)}else{let s=h[o++],f=h[o++],w=h[o++],p=h[o++];if((s&128)>0||(f&128)>0||(w&128)>0||(p&128)>0){o-=8;return}if(t<10){if(t===8)return $(e,r,n,i,s,f,w,p);{let v=h[o++];if((v&128)>0){o-=9;return}return $(e,r,n,i,s,f,w,p,v)}}else if(t<12){let v=h[o++],k=h[o++];if((v&128)>0||(k&128)>0){o-=10;return}if(t<11)return $(e,r,n,i,s,f,w,p,v,k);let S=h[o++];if((S&128)>0){o-=11;return}return $(e,r,n,i,s,f,w,p,v,k,S)}else{let v=h[o++],k=h[o++],S=h[o++],A=h[o++];if((v&128)>0||(k&128)>0||(S&128)>0||(A&128)>0){o-=12;return}if(t<14){if(t===12)return $(e,r,n,i,s,f,w,p,v,k,S,A);{let U=h[o++];if((U&128)>0){o-=13;return}return $(e,r,n,i,s,f,w,p,v,k,S,A,U)}}else{let U=h[o++],E=h[o++];if((U&128)>0||(E&128)>0){o-=14;return}if(t<15)return $(e,r,n,i,s,f,w,p,v,k,S,A,U,E);let K=h[o++];if((K&128)>0){o-=15;return}return $(e,r,n,i,s,f,w,p,v,k,S,A,U,E,K)}}}}}function sr(){let t=h[o++],e;if(t<192)e=t-160;else switch(t){case 217:e=h[o++];break;case 218:e=M.getUint16(o),o+=2;break;case 219:e=M.getUint32(o),o+=4;break;default:throw new Error("Expected string")}return De(e)}function at(t){return N.copyBuffers?Uint8Array.prototype.slice.call(h,o,o+=t):h.subarray(o,o+=t)}function xe(t){let e=h[o++];if(G[e])return G[e](h.subarray(o,o+=t));throw new Error("Unknown extension type "+e)}var or=new Array(4096);function Cr(){let t=h[o++];if(t>=160&&t<192){if(t=t-160,Y>=o)return le.slice(o-H,(o+=t)-H);if(!(Y==0&&fe<180))return ct(t)}else return o--,D();let e=(t<<5^(t>1?M.getUint16(o):t>0?h[o]:0))&4095,r=or[e],n=o,i=o+t-3,s,f=0;if(r&&r.bytes==t){for(;n<i;){if(s=M.getUint32(n),s!=r[f++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=h[n++],s!=r[f++]){n=1879048192;break}if(n===i)return o=n,r.string;i-=3,n=o}for(r=[],or[e]=r,r.bytes=t;n<i;)s=M.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=h[n++],r.push(s);let w=t<16?Tt(t):zr(t);return w!=null?r.string=w:r.string=ct(t)}const ar=(t,e)=>{var r=D();let n=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,r.highByte=e);let i=P[t];return i&&i.isShared&&((P.restoreStructures||(P.restoreStructures=[]))[t]=i),P[t]=r,r.read=Ot(r,n),r.read()};var $r=typeof self=="object"?self:global;G[0]=()=>{};G[0].noBuffer=!0;G[101]=()=>{let t=D();return($r[t[0]]||Error)(t[1])};G[105]=t=>{let e=M.getUint32(o-4);ne||(ne=new Map);let r=h[o],n;r>=144&&r<160||r==220||r==221?n=[]:n={};let i={target:n};ne.set(e,i);let s=D();return i.used?Object.assign(n,s):(i.target=s,s)};G[112]=t=>{let e=M.getUint32(o-4),r=ne.get(e);return r.used=!0,r.target};G[115]=()=>new Set(D());const Rr=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");G[116]=t=>{let e=t[0],r=Rr[e];if(!r)throw new Error("Could not find typed array for code "+e);return new $r[r](Uint8Array.prototype.slice.call(t,1).buffer)};G[120]=()=>{let t=D();return new RegExp(t[0],t[1])};const ni=[];G[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],r=o;return o+=e-t.length,L=ni,L=[sr(),sr()],L.position0=0,L.position1=0,L.postBundlePosition=o,o=r,D()};G[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function Lr(t){let e=fe,r=o,n=H,i=Y,s=le,f=ne,w=L,p=new Uint8Array(h.slice(0,fe)),v=P,k=P.slice(0,P.length),S=N,A=ke,U=t();return fe=e,o=r,H=n,Y=i,le=s,ne=f,L=w,h=p,ke=A,P=v,P.splice(0,P.length,...k),N=S,M=new DataView(h.buffer,h.byteOffset,h.byteLength),U}function dt(){h=null,ne=null,P=null}const Mt=new Array(147);for(let t=0;t<256;t++)Mt[t]=+("1e"+Math.floor(45.15-t*.30103));var Ye=new We({useRecords:!1});const ii=Ye.unpack;Ye.unpackMultiple;Ye.unpack;let si=new Float32Array(1);new Uint8Array(si.buffer,0,4);let Le;try{Le=new TextEncoder}catch{}let ht,Fr;const Qe=typeof Buffer!="undefined",$e=Qe?Buffer.allocUnsafeSlow:Uint8Array,qr=Qe?Buffer:Uint8Array,lr=Qe?4294967296:2144337920;let l,Pe,I,a=0,q,R=null;const oi=61440,ai=/[\u0080-\uFFFF]/,be=Symbol("record-id");class li extends We{constructor(e){super(e),this.offset=0;let r,n,i,s,f=0,w=qr.prototype.utf8Write?function(u,_,d){return l.utf8Write(u,_,d)}:Le&&Le.encodeInto?function(u,_){return Le.encodeInto(u,l.subarray(_)).written}:!1,p=this;e||(e={});let v=e&&e.sequential,k=e.structures||e.saveStructures,S=e.maxSharedStructures;if(S==null&&(S=k?32:0),S>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(e.moreTypes=!0);let A=e.maxOwnStructures;A==null&&(A=k?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let U=S>32||A+S>64,E=S+64,K=S+A+64;if(K>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let J=[],he=0,X=0;this.pack=this.encode=function(u,_){if(l||(l=new $e(8192),I=new DataView(l.buffer,0,8192),a=0),q=l.length-10,q-a<2048?(l=new $e(l.length),I=new DataView(l.buffer,0,l.length),q=l.length-10,a=0):a=a+7&2147483640,r=a,s=p.structuredClone?new Map:null,p.bundleStrings&&typeof u!="string"?(R=[],R.size=1/0):R=null,i=p.structures,i){i.uninitialized&&(i=p._mergeStructures(p.getStructures()));let d=i.sharedLength||0;if(d>S)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let c=0;c<d;c++){let x=i[c];if(!x)continue;let B,T=i.transitions;for(let b=0,z=x.length;b<z;b++){let W=x[b];B=T[W],B||(B=T[W]=Object.create(null)),T=B}T[be]=c+64}f=d}v||(i.nextId=d+64)}n&&(n=!1);try{if(j(u),R&&cr(r,j),p.offset=a,s&&s.idsToInsert){a+=s.idsToInsert.length*6,a>q&&we(a),p.offset=a;let d=ui(l.subarray(r,a),s.idsToInsert);return s=null,d}return _&ci?(l.start=r,l.end=a,l):l.subarray(r,a)}finally{if(i){X<10&&X++;let d=i.sharedLength||S;if(i.length>d&&(i.length=d),he>1e4)i.transitions=null,X=0,he=0,J.length>0&&(J=[]);else if(J.length>0&&!v){for(let c=0,x=J.length;c<x;c++)J[c][be]=0;J=[]}if(n&&p.saveStructures){let c=l.subarray(r,a);return p.saveStructures(i,f)===!1?(p._mergeStructures(p.getStructures()),p.pack(u)):(f=d,c)}}_&di&&(a=r)}};const j=u=>{a>q&&(l=we(a));var _=typeof u,d;if(_==="string"){let c=u.length;if(R&&c>=4&&c<4096){if((R.size+=c)>oi){let b,z=(R[0]?R[0].length*3+R[1].length:0)+10;a+z>q&&(l=we(a+z)),R.position?(l[a]=200,a+=3,l[a++]=98,b=a-r,a+=4,cr(r,j),I.setUint16(b+r-3,a-r-b)):(l[a++]=214,l[a++]=98,b=a-r,a+=4),R=["",""],R.size=0,R.position=b}let T=ai.test(u);R[T?0:1]+=u,l[a++]=193,j(T?-c:c);return}let x;c<32?x=1:c<256?x=2:c<65536?x=3:x=5;let B=c*3;if(a+B>q&&(l=we(a+B)),c<64||!w){let T,b,z,W=a+x;for(T=0;T<c;T++)b=u.charCodeAt(T),b<128?l[W++]=b:b<2048?(l[W++]=b>>6|192,l[W++]=b&63|128):(b&64512)===55296&&((z=u.charCodeAt(T+1))&64512)===56320?(b=65536+((b&1023)<<10)+(z&1023),T++,l[W++]=b>>18|240,l[W++]=b>>12&63|128,l[W++]=b>>6&63|128,l[W++]=b&63|128):(l[W++]=b>>12|224,l[W++]=b>>6&63|128,l[W++]=b&63|128);d=W-a-x}else d=w(u,a+x,B);d<32?l[a++]=160|d:d<256?(x<2&&l.copyWithin(a+2,a+1,a+1+d),l[a++]=217,l[a++]=d):d<65536?(x<3&&l.copyWithin(a+3,a+2,a+2+d),l[a++]=218,l[a++]=d>>8,l[a++]=d&255):(x<5&&l.copyWithin(a+5,a+3,a+3+d),l[a++]=219,I.setUint32(a,d),a+=4),a+=d}else if(_==="number")if(u>>>0===u)u<64?l[a++]=u:u<256?(l[a++]=204,l[a++]=u):u<65536?(l[a++]=205,l[a++]=u>>8,l[a++]=u&255):(l[a++]=206,I.setUint32(a,u),a+=4);else if(u>>0===u)u>=-32?l[a++]=256+u:u>=-128?(l[a++]=208,l[a++]=u+256):u>=-32768?(l[a++]=209,I.setInt16(a,u),a+=2):(l[a++]=210,I.setInt32(a,u),a+=4);else{let c;if((c=this.useFloat32)>0&&u<4294967296&&u>=-2147483648){l[a++]=202,I.setFloat32(a,u);let x;if(c<4||(x=u*Mt[(l[a]&127)<<1|l[a+1]>>7])>>0===x){a+=4;return}else a--}l[a++]=203,I.setFloat64(a,u),a+=8}else if(_==="object")if(!u)l[a++]=192;else{if(s){let x=s.get(u);if(x){if(!x.id){let B=s.idsToInsert||(s.idsToInsert=[]);x.id=B.push(x)}l[a++]=214,l[a++]=112,I.setUint32(a,x.id),a+=4;return}else s.set(u,{offset:a-r})}let c=u.constructor;if(c===Object)Zt(u,!0);else if(c===Array){d=u.length,d<16?l[a++]=144|d:d<65536?(l[a++]=220,l[a++]=d>>8,l[a++]=d&255):(l[a++]=221,I.setUint32(a,d),a+=4);for(let x=0;x<d;x++)j(u[x])}else if(c===Map){d=u.size,d<16?l[a++]=128|d:d<65536?(l[a++]=222,l[a++]=d>>8,l[a++]=d&255):(l[a++]=223,I.setUint32(a,d),a+=4);for(let[x,B]of u)j(x),j(B)}else{for(let x=0,B=ht.length;x<B;x++){let T=Fr[x];if(u instanceof T){let b=ht[x];if(b.write){b.type&&(l[a++]=212,l[a++]=b.type,l[a++]=0),j(b.write.call(this,u));return}let z=l,W=I,te=a;l=null;let pe;try{pe=b.pack.call(this,u,Te=>(l=z,z=null,a+=Te,a>q&&we(a),{target:l,targetView:I,position:a-Te}),j)}finally{z&&(l=z,I=W,a=te,q=l.length-10)}pe&&(pe.length+a>q&&we(pe.length+a),a=fi(pe,l,a,b.type));return}}Zt(u,!u.hasOwnProperty)}}else if(_==="boolean")l[a++]=u?195:194;else if(_==="bigint"){if(u<BigInt(1)<<BigInt(63)&&u>=-(BigInt(1)<<BigInt(63)))l[a++]=211,I.setBigInt64(a,u);else if(u<BigInt(1)<<BigInt(64)&&u>0)l[a++]=207,I.setBigUint64(a,u);else if(this.largeBigIntToFloat)l[a++]=203,I.setFloat64(a,Number(u));else throw new RangeError(u+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");a+=8}else if(_==="undefined")this.encodeUndefinedAsNil?l[a++]=192:(l[a++]=212,l[a++]=0,l[a++]=0);else if(_==="function")j(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+_)},Zt=this.useRecords===!1?this.variableMapSize?u=>{let _=Object.keys(u),d=_.length;d<16?l[a++]=128|d:d<65536?(l[a++]=222,l[a++]=d>>8,l[a++]=d&255):(l[a++]=223,I.setUint32(a,d),a+=4);let c;for(let x=0;x<d;x++)j(c=_[x]),j(u[c])}:(u,_)=>{l[a++]=222;let d=a-r;a+=2;let c=0;for(let x in u)(_||u.hasOwnProperty(x))&&(j(x),j(u[x]),c++);l[d+++r]=c>>8,l[d+r]=c&255}:e.progressiveRecords&&!U?(u,_)=>{let d,c=i.transitions||(i.transitions=Object.create(null)),x=a++-r,B;for(let T in u)if(_||u.hasOwnProperty(T)){if(d=c[T],d)c=d;else{let b=Object.keys(u),z=c;c=i.transitions;let W=0;for(let te=0,pe=b.length;te<pe;te++){let Te=b[te];d=c[Te],d||(d=c[Te]=Object.create(null),W++),c=d}x+r+1==a?(a--,st(c,b,W)):Kt(c,b,x,W),B=!0,c=z[T]}j(u[T])}if(!B){let T=c[be];T?l[x+r]=T:Kt(c,Object.keys(u),x,0)}}:(u,_)=>{let d,c=i.transitions||(i.transitions=Object.create(null)),x=0;for(let T in u)(_||u.hasOwnProperty(T))&&(d=c[T],d||(d=c[T]=Object.create(null),x++),c=d);let B=c[be];B?B>=96&&U?(l[a++]=((B-=96)&31)+96,l[a++]=B>>5):l[a++]=B:st(c,c.__keys__||Object.keys(u),x);for(let T in u)(_||u.hasOwnProperty(T))&&j(u[T])},we=u=>{let _;if(u>16777216){if(u-r>lr)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(lr,Math.round(Math.max((u-r)*(u>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(u-r<<2,l.length-1)>>12)+1<<12;let d=new $e(_);return I=new DataView(d.buffer,0,_),l.copy?l.copy(d,0,r,u):d.set(l.slice(r,u)),a-=r,r=0,q=d.length-10,l=d},st=(u,_,d)=>{let c=i.nextId;c||(c=64),c<E&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(c=i.nextOwnId,c<K||(c=E),i.nextOwnId=c+1):(c>=K&&(c=E),i.nextId=c+1);let x=_.highByte=c>=96&&U?c-96>>5:-1;u[be]=c,u.__keys__=_,i[c-64]=_,c<E?(_.isShared=!0,i.sharedLength=c-63,n=!0,x>=0?(l[a++]=(c&31)+96,l[a++]=x):l[a++]=c):(x>=0?(l[a++]=213,l[a++]=114,l[a++]=(c&31)+96,l[a++]=x):(l[a++]=212,l[a++]=114,l[a++]=c),d&&(he+=X*d),J.length>=A&&(J.shift()[be]=0),J.push(u),j(_))},Kt=(u,_,d,c)=>{let x=l,B=a,T=q,b=r;l=Pe,a=0,r=0,l||(Pe=l=new $e(8192)),q=l.length-10,st(u,_,c),Pe=l;let z=a;if(l=x,a=B,q=T,r=b,z>1){let W=a+z-1;W>q&&we(W);let te=d+r;l.copyWithin(te+z,te+1,a),l.set(Pe.slice(0,z),te),a=W}else l[d+r]=Pe[0]}}useBuffer(e){l=e,I=new DataView(l.buffer,l.byteOffset,l.byteLength),a=0}clearSharedData(){this.structures&&(this.structures=[])}}Fr=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,jr];ht=[{pack(t,e,r){let n=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:f}=e(6);i[f++]=214,i[f++]=255,s.setUint32(f,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:f}=e(10);i[f++]=215,i[f++]=255,s.setUint32(f,t.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(f+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return e(0),r(this.onInvalidDate());let{target:i,targetView:s,position:f}=e(3);i[f++]=212,i[f++]=255,i[f++]=255}else{let{target:i,targetView:s,position:f}=e(15);i[f++]=199,i[f++]=12,i[f++]=255,s.setUint32(f,t.getMilliseconds()*1e6),s.setBigInt64(f+4,BigInt(Math.floor(n)))}}},{pack(t,e,r){let n=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([t.name,t.message])}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([t.source,t.flags])}},{pack(t,e){this.moreTypes?fr(t,16,e):ur(Qe?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let r=t.constructor;r!==qr&&this.moreTypes?fr(t,Rr.indexOf(r.name),e):ur(t,e)}},{pack(t,e){let{target:r,position:n}=e(1);r[n]=193}}];function fr(t,e,r,n){let i=t.byteLength;if(i+1<256){var{target:s,position:f}=r(4+i);s[f++]=199,s[f++]=i+1}else if(i+1<65536){var{target:s,position:f}=r(5+i);s[f++]=200,s[f++]=i+1>>8,s[f++]=i+1&255}else{var{target:s,position:f,targetView:w}=r(7+i);s[f++]=201,w.setUint32(f,i+1),f+=4}s[f++]=116,s[f++]=e,s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),f)}function ur(t,e){let r=t.byteLength;var n,i;if(r<256){var{target:n,position:i}=e(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=e(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=e(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(t,i)}function fi(t,e,r,n){let i=t.length;switch(i){case 1:e[r++]=212;break;case 2:e[r++]=213;break;case 4:e[r++]=214;break;case 8:e[r++]=215;break;case 16:e[r++]=216;break;default:i<256?(e[r++]=199,e[r++]=i):i<65536?(e[r++]=200,e[r++]=i>>8,e[r++]=i&255):(e[r++]=201,e[r++]=i>>24,e[r++]=i>>16&255,e[r++]=i>>8&255,e[r++]=i&255)}return e[r++]=n,e.set(t,r),r+=i,r}function ui(t,e){let r,n=e.length*6,i=t.length-n;for(e.sort((s,f)=>s.offset>f.offset?1:-1);r=e.pop();){let s=r.offset,f=r.id;t.copyWithin(s+n,s,i),n-=6;let w=s+n;t[w++]=214,t[w++]=105,t[w++]=f>>24,t[w++]=f>>16&255,t[w++]=f>>8&255,t[w++]=f&255,i=s}return t}function cr(t,e){I.setUint32(R.position+t,a-R.position-t);let r=R;R=null,e(r[0]),e(r[1])}let Vr=new li({useRecords:!1});Vr.pack;Vr.pack;const ci=512,di=1024;var hi="https://izx.dalukuankuan.com/",Nr="https://i-desk-ver.izhenxiang.com/",Gr,wi=async t=>{var e,r;return t=await t,r=[],e=r.push.bind(r),t.on("data",e),new Promise((n,i)=>(t.on("end",()=>{n(Buffer.concat(r))}),t.on("error",i)))},pi=t=>wi(Jr(t));Gr=t=>{var e;return e=m.net.request(t),e.end(),new Promise((r,n)=>(e.on("error",i=>{n(i)}),e.on("response",i=>{if(i.statusCode!==200){n(i);return}r(i)})))};var Jr=t=>Gr(t),ze={};ze.version="1.0.0";ze.encode=function(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")};ze.decode=function(e){return e+=Array(5-e.length%4).join("="),e=e.replace(/\-/g,"+").replace(/\_/g,"/"),new Buffer(e,"base64")};ze.validate=function(e){return/^[A-Za-z0-9\-_]+$/.test(e)};var lt=ze;var _e,Hr,Fe,et,Pt,je,Ut,Zr,Kr,At,Je,Xr,Bt,Wt,He,wt,tt;Kr=En.promisify(mr.brotliDecompress);var Yr=()=>(m.app.relaunch(),m.app.exit());_e=V.join(vr.ROOT,"v");oe.mkdirSync(_e,{recursive:!0});Hr="sha512";He=void 0;var Qr=()=>{ie(He),He=void 0},en=()=>{Qr(),He=de.update({width:400,height:500,resizable:!1})};Je=t=>pi(Nr+t);Xr=t=>{var e;return e=In.createHash(Hr),new Promise(r=>oe.createReadStream(t).on("data",e.update.bind(e)).on("end",()=>{r(e.digest().slice(0,8))}))};wt=(()=>{var t;return{v:t}=Ve.default,t&&ue.decode(t)})();var jt=()=>ue.PACKAGE_JSON().version,xi=async()=>["desk",await jt(),ge.default.type(),ge.default.release(),ge.default.arch(),"ol"].join(" ");Ut=Cn+"/"+Yn+"/";tt=ue.ver_int(jt());je=0;Wt=async()=>{var t,e;t=ue.encode(parseInt(new Date/1e3)),e=Ut+"v?"+t;try{je=await Je(e)}catch{console.error("❌",e)}return je};Zr=async t=>{var e,r,n,i,s,f,w,p,v,k,S,A,U,E,K,J,he,X;if(t||(t=je||await Wt()),!!t&&(X=t.readUintBE(0,6),!(tt>=X))){if(n=ue.encode(X),e=V.join(_e,n),oe.existsSync(V.join(e,ue.package_json))&&X===wt)return e;for(J=lt.encode(await Je(Ut+lt.encode(t))),[r,i,w]=ii(await Kr(await Je(J))),A=j=>Ue.mkdir(V.join(e,j),{recursive:!0}),await Promise.all(r.map(A)),E=V.dirname(__dirname),U=v=0,k=i.length;v<k;U=++v)if(p=i[U],s=V.join(e,p),f=w[U],K=async j=>Buffer.compare(f,await Xr(j))===0,!(oe.existsSync(s)&&await K(s))){if(await A(V.dirname(p)),S=V.join(E,p),oe.existsSync(S)&&await K(S)){await Ue.copyFile(S,s);continue}if(he=oe.createWriteStream(s),(await Jr(Nr+lt.encode(f))).pipe(mr.createBrotliDecompress()).pipe(he),await new Promise(j=>{he.on("finish",j)}),!await K(s))return}return Ve.default.v=n,wt=X,e}};var tn=async()=>{var t,e;return t=await Wt(),t&&(e=tt<t.readUintBE(0,6),e)?t:0};At=async()=>{var t;(t=await tn())&&await rn(t)};setInterval(At,864e5);Fe=et=Pt=void 0;Bt=()=>et=new Promise(t=>Pt=t);Bt();var gi=()=>et,rn=(...t)=>(Fe||(Fe=Zr(...t).then(async e=>{e&&(Pt([je,JSON.parse(await Ue.readFile(V.join(e,ue.package_json),"utf8")).description]),Bt())}).finally(()=>{Fe=!1})),et);setTimeout(async()=>{var t,e,r,n;if(oe.existsSync(_e)){n=await Ue.readdir(_e,{withFileTypes:!0});for(e of n)e.isDirectory()&&({name:r}=e,ue.decode(r)<tt&&await Ue.rm(V.join(_e,r),{recursive:!0,force:!0}))}if(t=parseInt(new Date/864e5),t!==Ve.default.update_check)return Ve.default.update_check=t,await At()},15e3);var yi=Object.freeze(Object.defineProperty({__proto__:null,relaunch:Yr,x:Qr,show:en,ver_now:jt,ua_now:xi,update_check:tn,update_promise:gi,update:rn},Symbol.toStringTag,{value:"Module"})),nn={ID:""},It=new Proxy({},{get:(t,e)=>r=>{var n,i,s,f;return{width:s,height:i}=m.screen.getPrimaryDisplay().size,n={width:s,height:i,roundedCorners:!1,transparent:!0,resizable:!1,hasShadow:!1},e.startsWith("confirm")&&(n.webPreferences=Me({},r.webPreferences)),f=de[e](n),f.setAlwaysOnTop(!0,"screen-saver"),f.setPosition(0,0),f.setVisibleOnAllWorkspaces(!0,{visibleOnFullScreen:!0}),f}}),ve={},Et={},mi=require("./$.node");const dr=ge.default;let pt;(dr.platform()==="win32"||dr.platform()==="darwin")&&(pt=mi.getIcon);const vi=(t,e=64)=>{if(!!pt)return pt(t,e)};var bi=vi,rt={};Object.defineProperty(rt,"__esModule",{value:!0});const se=ve,_i=ge.default,ft=t=>{if(!(!se.addon||!se.addon.getMonitorInfo))return se.addon.getMonitorInfo(t)};class Si{constructor(e){this.id=e}getBounds(){return ft(this.id).bounds}getWorkArea(){return ft(this.id).workArea}isPrimary(){return ft(this.id).isPrimary}getScaleFactor(){if(!se.addon||!se.addon.getMonitorScaleFactor)return;const e=_i.release().split(".").map(r=>parseInt(r,10));return e[0]>8||e[0]===8&&e[1]>=1?se.addon.getMonitorScaleFactor(this.id):1}isValid(){return se.addon&&se.addon.getMonitorInfo}}rt.Monitor=Si;var nt={};Object.defineProperty(nt,"__esModule",{value:!0});class ki{getBounds(){return{x:0,y:0,width:0,height:0}}getWorkArea(){return{x:0,y:0,width:0,height:0}}isPrimary(){return!1}getScaleFactor(){return 1}isValid(){return!1}}nt.EmptyMonitor=ki;var Oi=ae.commonjsGlobal&&ae.commonjsGlobal.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Et,"__esModule",{value:!0});const g=ve,Ti=Oi(bi),Mi=rt,Pi=nt;class Ze{constructor(e){if(!g.addon)return;this.id=e;const{processId:r,path:n}=g.addon.initWindow(e);this.processId=r,this.path=n}getBounds(){if(!g.addon)return;const e=g.addon.getWindowBounds(this.id);if(process.platform==="win32"){const r=this.getMonitor().getScaleFactor();e.x=Math.floor(e.x/r),e.y=Math.floor(e.y/r),e.width=Math.floor(e.width/r),e.height=Math.floor(e.height/r)}return e}setBounds(e){if(!g.addon)return;const r=Object.assign(Object.assign({},this.getBounds()),e);if(process.platform==="win32"){const n=this.getMonitor().getScaleFactor();r.x=Math.floor(r.x*n),r.y=Math.floor(r.y*n),r.width=Math.floor(r.width*n),r.height=Math.floor(r.height*n),g.addon.setWindowBounds(this.id,r)}else process.platform==="darwin"&&g.addon.setWindowBounds(this.id,r)}getTitle(){if(!!g.addon)return g.addon.getWindowTitle(this.id)}getMonitor(){return!g.addon||!g.addon.getMonitorFromWindow?new Pi.EmptyMonitor:new Mi.Monitor(g.addon.getMonitorFromWindow(this.id))}show(){!g.addon||!g.addon.showWindow||g.addon.showWindow(this.id,"show")}hide(){!g.addon||!g.addon.showWindow||g.addon.showWindow(this.id,"hide")}minimize(){!g.addon||(process.platform==="win32"?g.addon.showWindow(this.id,"minimize"):process.platform==="darwin"&&g.addon.setWindowMinimized(this.id,!0))}restore(){!g.addon||(process.platform==="win32"?g.addon.showWindow(this.id,"restore"):process.platform==="darwin"&&g.addon.setWindowMinimized(this.id,!1))}maximize(){!g.addon||(process.platform==="win32"?g.addon.showWindow(this.id,"maximize"):process.platform==="darwin"&&g.addon.setWindowMaximized(this.id))}bringToTop(){!g.addon||(process.platform==="darwin"?g.addon.bringWindowToTop(this.id,this.processId):g.addon.bringWindowToTop(this.id))}redraw(){!g.addon||!g.addon.redrawWindow||g.addon.redrawWindow(this.id)}isWindow(){if(!!g.addon){if(process.platform==="win32")return this.path&&this.path!==""&&g.addon.isWindow(this.id);if(process.platform==="darwin")return this.path&&this.path!==""&&!!g.addon.initWindow(this.id)}}isVisible(){return!g.addon||!g.addon.isWindowVisible?!0:g.addon.isWindowVisible(this.id)}toggleTransparency(e){!g.addon||!g.addon.toggleWindowTransparency||g.addon.toggleWindowTransparency(this.id,e)}setOpacity(e){!g.addon||!g.addon.setWindowOpacity||g.addon.setWindowOpacity(this.id,e)}getOpacity(){return!g.addon||!g.addon.getWindowOpacity?1:g.addon.getWindowOpacity(this.id)}getIcon(e=64){return Ti.default(this.path,e)}setOwner(e){if(!g.addon||!g.addon.setWindowOwner)return;let r=e;e instanceof Ze?r=e.id:e||(r=0),g.addon.setWindowOwner(this.id,r)}getOwner(){if(!(!g.addon||!g.addon.getWindowOwner))return new Ze(g.addon.getWindowOwner(this.id))}}Et.Window=Ze;var Ui=require("./-.node"),Ai=ae.commonjsGlobal&&ae.commonjsGlobal.__awaiter||function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function w(k){try{v(n.next(k))}catch(S){f(S)}}function p(k){try{v(n.throw(k))}catch(S){f(S)}}function v(k){k.done?s(k.value):i(k.value).then(w,p)}v((n=n.apply(t,e||[])).next())})};Object.defineProperty(ve,"__esModule",{value:!0});const qe=Et;ve.Window=qe.Window;const Bi=zn.default,hr=ge.default,Wi=rt,ji=nt;let C;ve.addon=C;(hr.platform()==="win32"||hr.platform()==="darwin")&&(ve.addon=C=Ui);let wr=null,Re=[];class Ii extends Bi.EventEmitter{constructor(){super(),this.requestAccessibility=()=>!C||!C.requestAccessibility?!0:C.requestAccessibility(),this.getActiveWindow=()=>{if(!!C)return new qe.Window(C.getActiveWindow())},this.getWindows=()=>!C||!C.getWindows?[]:C.getWindows().map(r=>new qe.Window(r)).filter(r=>r.isWindow()),this.getMonitors=()=>!C||!C.getMonitors?[]:C.getMonitors().map(r=>new Wi.Monitor(r)),this.getPrimaryMonitor=()=>process.platform==="win32"?this.getMonitors().find(r=>r.isPrimary):new ji.EmptyMonitor,this.createProcess=(r,n="")=>{if(!(!C||!C.createProcess))return C.createProcess(r,n)};let e;!C||(this.on("newListener",r=>{if(r==="window-activated"&&(e=C.getActiveWindow()),Re.indexOf(r)===-1){if(r==="window-activated")wr=setInterval(()=>Ai(this,void 0,void 0,function*(){const n=C.getActiveWindow();e!==n&&(e=n,this.emit("window-activated",new qe.Window(n)))}),50);else return;Re.push(r)}}),this.on("removeListener",r=>{this.listenerCount(r)>0||(r==="window-activated"&&clearInterval(wr),Re=Re.filter(n=>n!==r))}))}}const Ei=new Ii;var sn=ve.windowManager=Ei,Dt,Z,xt,zt,on,an,ln,fn,un,cn,O;({recbar:cn,draw:fn}=de);O=void 0;Z=void 0;({draw:un}=It);var Di=(t,[e,r,n,i])=>{var s;Z||(t===0?Z=un():(s={roundedCorners:!1,transparent:!0,resizable:!1,width:n,height:i},Z=fn(s),Z.setAlwaysOnTop(!0,"screen-saver"),Z.setPosition(e,r),Z.setVisibleOnAllWorkspaces(!0,{visibleOnFullScreen:!0})),Z.on("close",()=>Z=void 0),dn())},dn=()=>{Oe(),Z.focus()},zi=()=>{ie(Z),Z=void 0};xt=["CommandOrControl+R","CommandOrControl+W","CommandOrControl+Q","Alt+F4","F5"];Dt={"browser-window-focus":()=>{var t;for(t of xt)m.globalShortcut.register(t,()=>{})},"browser-window-blur":()=>{var t;for(t of xt)m.globalShortcut.unregister(t,()=>{})}};var Ct=t=>{var e;return t==="camera"?e=500:e=696+30,on(e)};on=t=>{var e,r,n,i,s,f,w,p;s=Object.entries(Dt);for(p of s)[n,e]=p,m.app.on(n,e);return Xi(),r=48+40,i={roundedCorners:!1,transparent:!0,resizable:!1,width:t,height:r},O=cn(i),O.on("close",()=>O=void 0),{width:w,height:f}=m.screen.getPrimaryDisplay().workArea,O.setBounds({x:Math.round((w-t)/2),y:f-28-r,width:t,height:r}),Oe(),Be(),O.hookWindowMessage(278,()=>(O.setEnabled(!1),setTimeout(()=>O.setEnabled(!0),100),!0)),new Promise(v=>O.webContents.on("did-finish-load",()=>{Oe(),O.focus(),v(O)}))};var Oe=()=>{O&&(O.setAlwaysOnTop(!0,"screen-saver"),O.moveTop())};an=async function(){var t,e,r,n,i,s,f;return{width:f,height:s}=m.screen.getPrimaryDisplay().workArea,t=[0,0,f,s],n=await O.webContents.executeJavaScript("localStorage",!0),i=JSON.parse(n.record),i.src==="camera"?(r=Wr(),e=r.getBounds(),t=[e.x,e.y,e.width,e.height]):i.area!==0&&n.area&&(t=JSON.parse(n.area),t.length!==4&&(t=void 0)),t||(t=[0,0,f,s]),t};var Ci=()=>{var t,e,r,n,i,s,f,w,p;n=O.getPosition(),[r,e]=O.getSize(),[p,t]=O.size,t=48+40,{width:w,height:f}=m.screen.getPrimaryDisplay().bounds,i=n[0]+Math.round((r-p)/2),i<0&&(i=0),i>w-p&&(i=w-p),s=n[1]-(48-32),s<0&&(s=0),s>f-t&&(s=f-t),O.setBounds({x:i,y:s,width:p,height:t}),Oe()},$i=async()=>{var t,e,r,n,i,s,f,w;[f,w,i,t]=await an(),O.getPosition(),O.size=O.getSize(),s=88,e=32,{width:n,height:r}=m.screen.getPrimaryDisplay().bounds,w>60?w=w-e-5:w=0,f=f+Math.round((i-s)/2),f<0&&(f=0),f>n-s&&(f=n-s),O.setBounds({x:f,y:w,width:s,height:e}),O.moveTop()};zt=()=>{var t,e,r,n;r=Object.entries(Dt);for(n of r)[e,t]=n,m.app.off(e,t);vn(),Br()};var Ri=()=>{zt(),Ke("show")},Li=()=>{zt(),Ke()},Fi=()=>{O.hide()};ln=(...t)=>m.desktopCapturer.getSources({types:t,thumbnailSize:{width:0,height:0}});var qi=async()=>{var t,e;e=await ln("screen");for(t of e)return t.id},Vi=async()=>{var t,e,r,n,i,s,f,w,p,v,k,S,A,U,E;({bounds:t}=m.screen.getPrimaryDisplay()),{scaleFactor:k}=m.screen.getPrimaryDisplay(),s=new Map,p=await m.desktopCapturer.getSources({types:["window"],fetchWindowIcons:!1,thumbnailSize:{width:320*k,height:180*k}});for(n of p)s.set(Math.floor(n.id.split(":")[1]),[n.thumbnail.toDataURL(),n.name]);w=[],v=sn.getWindows();for(n of v)if({id:i}=n,!process.execPath.startsWith(n.path)&&(f=s.get(i),f)){if({x:U,y:E,width:A,height:r}=n.getBounds(),U+A<=0&&U<=0||U+A>t.width&&U>t.width||E+r<=0&&E<=0||E+r>t.height&&E>t.height)continue;S=t.width-U,A>S&&(A=S),e=t.height-E,r>e&&(r=e),U<0&&(U=0),E<0&&(E=0),w.push(f.concat([i,U,E,A,r]))}return w},Ni=t=>{m.BrowserWindow.getAllWindows().forEach(e=>{var r;if({hash:r}=new URL(e.webContents.getURL()),!t&&r.slice(1)==="camera"){ie(e);return}return e.hide()})},hn=function(){O!==void 0&&!O.isDestroyed()&&O.webContents.send("quick_stop","stop"),setTimeout(()=>{if(O!==void 0&&!O.isDestroyed())return Yr()},5e3)},wn=function(){O!==void 0&&!O.isDestroyed()&&O.webContents.send("quick_cmd","pause")},Gi=function(){O!==void 0&&!O.isDestroyed()&&O.webContents.send("quick_cmd","resume")},Ji=Object.freeze(Object.defineProperty({__proto__:null,draw:Di,draw_top:dn,draw_x:zi,工具条:Ct,top:Oe,expand:Ci,fold:$i,cancel:Ri,end:Li,hide:Fi,screen_source:qi,win_source:Vi,stop:Ni,send_quick_stop:hn,send_quick_pause:wn,send_quick_resume:Gi},Symbol.toStringTag,{value:"Module"})),pn,Q;({guide:pn}=de);Q=void 0;var Hi=function(){return ie(Q),Q=void 0,ce()},xn=function(){if(Q!==void 0&&!Q.isDestroyed()){Q.show(),gt();return}Q=pn({width:520,height:510,center:!0,roundedCorners:!1,resizable:!1,transparent:!0}),gt()},gt=function(){Q&&!Q.isDestroyed()&&Q.moveTop()},Zi=Object.freeze(Object.defineProperty({__proto__:null,x:Hi,show:xn,top_once:gt},Symbol.toStringTag,{value:"Module"}));var it,$t,gn,yt,Rt,Ki,Lt,yn,mn,Ie;ge.default.platform();({Menu:$t,Tray:gn,app:yt,globalShortcut:Ki}=require("electron"));Ie=new gn(V.join(_t,"trayTemplate.png"));Lt=[{label:"我的空间",click:()=>{m.shell.openExternal(hi+"video_library.html?user_token="+nn.ID)}},{label:"操作指引",click:xn},{label:"检测更新",click:en},{type:"separator"}];it=yn=$t.buildFromTemplate([{label:"显示界面",click:ce},{label:"快速录制",click:Ln},...Lt,{label:"退出",click:()=>(yt.quiting=!0,yt.quit())}]);mn=$t.buildFromTemplate([{label:"结束录制",click:hn},...Lt]);Rt=["click",()=>{ce()}];Ie.on("right-click",t=>{Ie.popUpContextMenu(it)});var Xi=()=>{Ie.off(...Rt),it=mn},vn=()=>{Ie.on(...Rt),it=yn};var bn;bn=t=>{var e,r,n,i,s,f,w,p;t&&(t.devToolsWebContents||({webContents:s}=t,e=new m.BrowserWindow({minimizable:!1,maximizable:!1}),[i,r]=t.getSize(),[w,p]=t.getPosition(),{width:f,height:n}=m.screen.getPrimaryDisplay().workArea,s.setDevToolsWebContents(e.webContents),s.openDevTools({mode:"detach"}),i>r?(p=0,i=0,r+=20,n-=r):(w=0,r=0,f-=i),e.setPosition(i,r),t.setPosition(w,p),e.setSize(f,n),t.focus()))};var Yi=()=>{m.globalShortcut.register("CmdOrCtrl+Alt+I",()=>bn(m.BrowserWindow.getFocusedWindow()))},_n,F;({count_down:_n}=de);F=void 0;var Sn=()=>{var t;if(F){F.focus();return}t=240,F=_n({width:t,height:t,transparent:!0,resizable:!1,hasShadow:!1}),F.on("close",()=>{F=void 0}),F.setAlwaysOnTop(!0,"screen-saver"),F.on("show",()=>{var e,r,n,i;i=m.BrowserWindow.getAllWindows();for(r of i)r.webContents.getURL().endsWith("/#main")||r.setVisibleOnAllWorkspaces(!0,{visibleOnFullScreen:!0});n=setInterval(()=>F?F.moveTop():e(),300),e=()=>{clearInterval(n)},F.on("hide",e),F.on("close",e)})},Qi={hide:()=>{F!=null&&F.hide()},close:()=>{F!=null&&F.close(),Oe()}},es=typeof ae.commonjsGlobal=="object"&&ae.commonjsGlobal&&ae.commonjsGlobal.Object===Object&&ae.commonjsGlobal,ts=es,rs=ts,ns=typeof self=="object"&&self&&self.Object===Object&&self,is=rs||ns||Function("return this")(),ss=is,os=ss,as=os.Symbol,Ft=as,pr=Ft;pr&&pr.toStringTag;var xr=Ft;xr&&xr.toStringTag;var gr=Ft,yr=gr?gr.prototype:void 0;yr&&yr.toString;var ls=async t=>{};var Ee,qt,Vt,Nt,Gt;Ee=Vt=qt=void 0;Nt=()=>{qt=new Promise(t=>{Vt=t})};Nt();Gt=t=>{Ee.once("closed",()=>{Vt(t),Nt()}),ie(Ee)};var fs=()=>{Gt(!0)},us=()=>{Gt(!1)},kn=(t,e=void 0)=>{var r;return r={width:275,height:190,modal:!0,isAlwaysOnTop:!0,visibleOnAllWorkspaces:!0},e!==void 0&&(r.webPreferences=Me({},e)),Ee=It["confirm_"+t](r),Ee.setAlwaysOnTop(!0,"screen-saver"),qt},cs=async function(t,e,r,n="停止录制",i="继续录制",s=!0){var f,w,p,v;s&&wn(),p="<p>"+e,r&&(p+="<br>");for(f in r)v=r[f],p+=f+": "+v+"<br>";return p+="</p>",w={additionalArguments:["--my_title="+t,"--my_tip="+p,"--my_yes="+n,"--my_no="+i]},await kn("err",w)},ds=Object.freeze(Object.defineProperty({__proto__:null,y:fs,n:us,show:kn,show_err:cs},Symbol.toStringTag,{value:"Module"})),hs=t=>{var e;if(e=m.app.getLoginItemSettings().openAtLogin,e!==t)return m.app.setLoginItemSettings({openAtLogin:t})},ws=Object.freeze(Object.defineProperty({__proto__:null,auto_start:hs},Symbol.toStringTag,{value:"Module"})),ps=t=>{nn.ID=t},xs=Object.freeze(Object.defineProperty({__proto__:null,ID:ps},Symbol.toStringTag,{value:"Module"})),gs=function(){var t,e,r;return r=this.sender.getOwnerBrowserWindow(),e=r.getBounds(),t=n=>{var i,s;if(s=r[n],i=e[n],s&&i>s&&i-s<3){e[n]=s;return}r[n]=i},["height","width"].map(t),e},ys=function(t,e,r,n){var i,s;s=this.sender.getOwnerBrowserWindow();try{s.setBounds({x:Math.round(t),y:Math.round(e),width:r,height:n})}catch(f){i=f,console.error(JSON.stringify([t,e,r,n]),i)}},ms=Object.freeze(Object.defineProperty({__proto__:null,getBounds:gs,setBounds:ys},Symbol.toStringTag,{value:"Module"})),On,ee;({preference:On}=de);ee=void 0;var vs=function(){return ie(ee),ee=void 0,ce()},bs=function(){if(ee!==void 0&&!ee.isDestroyed()){ee.show(),mt();return}ee=On({width:570,height:400,center:!0,roundedCorners:!1,resizable:!1,transparent:!0}),mt()},mt=function(){ee&&!ee.isDestroyed()&&ee.moveTop()},_s=Object.freeze(Object.defineProperty({__proto__:null,x:vs,show:bs,top_once:mt},Symbol.toStringTag,{value:"Module"}));var Tn,Jt,Ht,ye,Mn;({area:Tn,win_area:Mn}=It);ye=void 0;var Ss=t=>{var e,r,n;r=void 0,n=sn.getWindows();for(e of n)if(t===e.id){r=e;break}r&&(ye.setAlwaysOnTop(!1),r.bringToTop(),Ht())};Ht=()=>{ye.setAlwaysOnTop(!0,"screen-saver")};Jt=t=>{ye=t(),Ht(),ye.on("close",()=>ye=void 0)};var ks=()=>Jt(Mn),Os=()=>Jt(Tn),Ts=()=>{Ct(),ye.setIgnoreMouseEvents(!0,{forward:!0}),Sn()},Ms=()=>{var t,e;return{x:t,y:e}=m.screen.getCursorScreenPoint(),[t,e]};function Ps(t,e,r,n){var i;if(i=t==="camera",!i&&n){[ks,Os][n-1]();return}else Sn();Ct(t)}var Us=(t,e,r,n)=>{Ke(),Ps(t,e,r,n)},As=t=>{m.shell.openExternal(t)},Bs=()=>vr.ROOT,Ws=Object.freeze(Object.defineProperty({__proto__:null,userData:Bs,close:Ke,x:kr,count_down:Qi,permission:ls,confirm:ds,auto_update:yi,auto_start:ws,recbar:Ji,USER:xs,camera:Xn,drag:ms,guide:Zi,preference:_s,area:Ts,wintop:Ss,main:ce,mouse:Ms,rec:Us,open:As},Symbol.toStringTag,{value:"Module"}));process.on("exit",()=>{m.app.quit()});m.app.requestSingleInstanceLock()||(m.app.quit(),process.exit(0));m.app.commandLine.appendSwitch("webrtc-max-cpu-consumption-percentage","100");m.app.commandLine.appendSwitch("js-flags","--expose_gc --max-old-space-size=512");(()=>{var t,e,r,n,i;ce(),t=(s,f)=>{var w,p,v,k;f instanceof Function&&m.ipcMain.handle(s.join("."),(S,A)=>f.apply(S,A)),v=Object.entries(f);for(k of v)[p,w]=k,t([...s,p],w)},r=Object.entries(Ws);for(i of r)[e,n]=i,t([e],n);vn(),Yi()})();$n(m.app,{"second-instance":ce,activate:ce});
