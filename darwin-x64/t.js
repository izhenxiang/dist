import S from"./9.js";import{c as o}from"./$0.js";import{b as h,g as y,m as b}from"./$-.js";import{v}from"./h.js";import{i as a}from"./3.js";import{k as q,I as M}from"./l.js";import"./2.js";import"./$3.js";import"./$5.js";import"./$.js";import"./a.js";import"./1.js";import"./s.js";import"./g.js";function T(){return new Worker("/r.js",{type:"module"})}var _,n,c,d,t,f,e,m,w,g,k,l,u,i;({camera:f}=a);c={};t=!1;try{g=await v()}catch(r){e=r,console.error("capture desktop failed",e),await a.confirm.show_err("屏幕录制失败","屏幕录制失败，请授权或咨询客服。",{错误信息:""+e}),a.recbar.send_quick_stop()}i=g.getVideoTracks()[0];({area:_}=o);_&&(u=new MediaStreamTrackProcessor({track:i,maxBufferSize:15}),i=new MediaStreamTrackGenerator({kind:"video"}),m=[u.readable,i.writable],w=()=>{new T().postMessage([localStorage.ppi-0,...m,...JSON.parse(localStorage.area)],m)});i.contentHint="detail";try{n=await h(),t=!0}catch(r){e=r,t=!1,console.error("failed to get audio from:",localStorage.audio,"err:",e),c={错误信息:""+e,设备信息:localStorage.audio}}await a.permission("microphone")&&(t=!1,c={错误信息:"未授权麦克风",设备信息:localStorage.audio});d=n?n.getTracks():[];try{l=await y(o.sys_audio)}catch(r){e=r,console.error("系统音频获取失败:",e),await a.confirm.show_err("系统音频获取失败","系统音频获取失败，请授权或咨询客服。",{错误信息:""+e},"停止录制",""),a.recbar.send_quick_stop()}k=new MediaStream([i,...b(d,l)]);q(async()=>{var r,s,p;r=!!o.audio;for(s of d)s.enabled=r;r&&!t&&(await a.confirm.show_err("音频获取失败","音频获取失败，请授权或咨询客服。",c)?a.recbar.send_quick_stop():a.recbar.send_quick_resume(),o.audio=""),p=o.sys_audio;for(s of l)s.enabled=p});M(()=>o.video,async()=>{var r;({video:r}=o),r?await f.show(localStorage.face_area_size-0):await f.hide()});S(k,d,w);
